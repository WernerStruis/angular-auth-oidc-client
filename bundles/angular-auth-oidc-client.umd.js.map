{"version":3,"file":"angular-auth-oidc-client.umd.js.map","sources":["ng://angular-auth-oidc-client/lib/models/authorization-result.ts","ng://angular-auth-oidc-client/lib/models/authorization-state.enum.ts","ng://angular-auth-oidc-client/lib/models/jwtkeys.ts","ng://angular-auth-oidc-client/lib/models/validation-result.enum.ts","ng://angular-auth-oidc-client/lib/models/validate-state-result.model.ts","ng://angular-auth-oidc-client/lib/data-services/oidc-data.service.ts","node_modules/tslib/tslib.es6.js","ng://angular-auth-oidc-client/lib/services/platform.provider.ts","ng://angular-auth-oidc-client/lib/services/auth-configuration.provider.ts","ng://angular-auth-oidc-client/lib/services/oidc.logger.service.ts","ng://angular-auth-oidc-client/lib/services/existing-iframe.service.ts","ng://angular-auth-oidc-client/lib/services/oidc-equality-helper.service.ts","ng://angular-auth-oidc-client/lib/services/oidc-token-helper.service.ts","ng://angular-auth-oidc-client/lib/services/oidc.security.storage.ts","ng://angular-auth-oidc-client/lib/services/oidc.security.common.ts","ng://angular-auth-oidc-client/lib/services/oidc.security.validation.ts","ng://angular-auth-oidc-client/lib/services/oidc-security-state-validation.service.ts","ng://angular-auth-oidc-client/lib/services/oidc.security.check-session.ts","ng://angular-auth-oidc-client/lib/services/oidc.security.config.service.ts","ng://angular-auth-oidc-client/lib/services/oidc.security.silent-renew.ts","ng://angular-auth-oidc-client/lib/services/oidc.security.user-service.ts","ng://angular-auth-oidc-client/lib/services/uri-encoder.ts","ng://angular-auth-oidc-client/lib/services/url-parser.service.ts","ng://angular-auth-oidc-client/lib/services/oidc.security.service.ts","ng://angular-auth-oidc-client/lib/modules/auth.module.ts"],"sourcesContent":["import { AuthorizationState } from './authorization-state.enum';\r\nimport { ValidationResult } from './validation-result.enum';\r\n\r\nexport class AuthorizationResult {\r\n    constructor(public authorizationState: AuthorizationState, public validationResult: ValidationResult, public isRenewProcess: boolean = false) {}\r\n}\r\n","export enum AuthorizationState {\r\n    authorized = 'authorized',\r\n    forbidden = 'forbidden',\r\n    unauthorized = 'unauthorized',\r\n}\r\n","export class JwtKeys {\r\n    keys: JwtKey[] = [];\r\n}\r\n\r\nexport class JwtKey {\r\n    kty = '';\r\n    use = '';\r\n    kid = '';\r\n    x5t = '';\r\n    e = '';\r\n    n = '';\r\n    x5c: any[] = [];\r\n}\r\n","export enum ValidationResult {\r\n    NotSet = 'NotSet',\r\n    StatesDoNotMatch = 'StatesDoNotMatch',\r\n    SignatureFailed = 'SignatureFailed',\r\n    IncorrectNonce = 'IncorrectNonce',\r\n    RequiredPropertyMissing = 'RequiredPropertyMissing',\r\n    MaxOffsetExpired = 'MaxOffsetExpired',\r\n    IssDoesNotMatchIssuer = 'IssDoesNotMatchIssuer',\r\n    NoAuthWellKnownEndPoints = 'NoAuthWellKnownEndPoints',\r\n    IncorrectAud = 'IncorrectAud',\r\n    TokenExpired = 'TokenExpired',\r\n    IncorrectAtHash = 'IncorrectAtHash',\r\n    Ok = 'Ok',\r\n    LoginRequired = 'LoginRequired',\r\n    SecureTokenServerError = 'SecureTokenServerError',\r\n}\r\n","import { ValidationResult } from './validation-result.enum';\r\n\r\n// tslint:disable: variable-name\r\nexport class ValidateStateResult {\r\n    constructor(\r\n        public access_token = '',\r\n        public id_token = '',\r\n        public authResponseIsValid = false,\r\n        public decoded_id_token: any = {},\r\n        public state: ValidationResult = ValidationResult.NotSet\r\n    ) {}\r\n}\r\n","import { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class OidcDataService {\r\n    constructor(private httpClient: HttpClient) {}\r\n\r\n    getWellknownEndpoints<T>(url: string): Observable<T> {\r\n        let headers = new HttpHeaders();\r\n        headers = headers.set('Accept', 'application/json');\r\n\r\n        return this.httpClient.get<T>(url, {\r\n            headers,\r\n        });\r\n    }\r\n\r\n    getIdentityUserData<T>(url: string, token: string): Observable<T> {\r\n        let headers = new HttpHeaders();\r\n        headers = headers.set('Accept', 'application/json');\r\n        headers = headers.set('Authorization', 'Bearer ' + decodeURIComponent(token));\r\n\r\n        return this.httpClient.get<T>(url, {\r\n            headers,\r\n        });\r\n    }\r\n\r\n    get<T>(url: string): Observable<T> {\r\n        let headers = new HttpHeaders();\r\n        headers = headers.set('Accept', 'application/json');\r\n\r\n        return this.httpClient.get<T>(url, {\r\n            headers,\r\n        });\r\n    }\r\n}\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { isPlatformBrowser } from '@angular/common';\r\nimport { Inject, Injectable, PLATFORM_ID } from '@angular/core';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class PlatformProvider {\r\n    get isBrowser() {\r\n        return isPlatformBrowser(this.platformId);\r\n    }\r\n\r\n    // tslint:disable-next-line: ban-types\r\n    constructor(@Inject(PLATFORM_ID) private platformId: Object) {}\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { OpenIdConfiguration, OpenIdInternalConfiguration } from '../models/auth.configuration';\r\nimport { AuthWellKnownEndpoints } from '../models/auth.well-known-endpoints';\r\nimport { PlatformProvider } from './platform.provider';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ConfigurationProvider {\r\n    private DEFAULT_CONFIG: OpenIdInternalConfiguration = {\r\n        stsServer: 'https://please_set',\r\n        redirect_url: 'https://please_set',\r\n        client_id: 'please_set',\r\n        response_type: 'code',\r\n        scope: 'openid email profile',\r\n        hd_param: '',\r\n        post_logout_redirect_uri: 'https://please_set',\r\n        start_checksession: false,\r\n        silent_renew: false,\r\n        silent_renew_url: 'https://please_set',\r\n        silent_renew_offset_in_seconds: 0,\r\n        use_refresh_token: false,\r\n        ignore_nonce_after_refresh: false,\r\n        post_login_route: '/',\r\n        forbidden_route: '/forbidden',\r\n        unauthorized_route: '/unauthorized',\r\n        auto_userinfo: true,\r\n        auto_clean_state_after_authentication: true,\r\n        trigger_authorization_result_event: false,\r\n        log_console_warning_active: true,\r\n        log_console_debug_active: false,\r\n        iss_validation_off: false,\r\n        history_cleanup_off: false,\r\n        max_id_token_iat_offset_allowed_in_seconds: 3,\r\n        isauthorizedrace_timeout_in_seconds: 5,\r\n        disable_iat_offset_validation: false,\r\n        storage: typeof Storage !== 'undefined' ? sessionStorage : null,\r\n    };\r\n\r\n    private INITIAL_AUTHWELLKNOWN: AuthWellKnownEndpoints = {\r\n        issuer: '',\r\n        jwks_uri: '',\r\n        authorization_endpoint: '',\r\n        token_endpoint: '',\r\n        userinfo_endpoint: '',\r\n        end_session_endpoint: '',\r\n        check_session_iframe: '',\r\n        revocation_endpoint: '',\r\n        introspection_endpoint: '',\r\n    };\r\n\r\n    private mergedOpenIdConfiguration: OpenIdInternalConfiguration = this.DEFAULT_CONFIG;\r\n    private authWellKnownEndpoints: AuthWellKnownEndpoints = this.INITIAL_AUTHWELLKNOWN;\r\n\r\n    private onConfigurationChangeInternal = new Subject<OpenIdConfiguration>();\r\n\r\n    get openIDConfiguration(): OpenIdInternalConfiguration {\r\n        return this.mergedOpenIdConfiguration;\r\n    }\r\n\r\n    get wellKnownEndpoints(): AuthWellKnownEndpoints {\r\n        return this.authWellKnownEndpoints;\r\n    }\r\n\r\n    get onConfigurationChange() {\r\n        return this.onConfigurationChangeInternal.asObservable();\r\n    }\r\n\r\n    constructor(private platformProvider: PlatformProvider) {}\r\n\r\n    setup(\r\n        passedOpenIfConfiguration: OpenIdConfiguration | null | undefined,\r\n        passedAuthWellKnownEndpoints: AuthWellKnownEndpoints | null | undefined\r\n    ) {\r\n        this.mergedOpenIdConfiguration = { ...this.mergedOpenIdConfiguration, ...passedOpenIfConfiguration };\r\n        this.setSpecialCases(this.mergedOpenIdConfiguration);\r\n        this.authWellKnownEndpoints = { ...passedAuthWellKnownEndpoints };\r\n        this.onConfigurationChangeInternal.next({ ...this.mergedOpenIdConfiguration });\r\n    }\r\n\r\n    private setSpecialCases(currentConfig: OpenIdConfiguration) {\r\n        if (!this.platformProvider.isBrowser) {\r\n            currentConfig.start_checksession = false;\r\n            currentConfig.silent_renew = false;\r\n            currentConfig.use_refresh_token = false;\r\n        }\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ConfigurationProvider } from './auth-configuration.provider';\r\n\r\n@Injectable()\r\nexport class LoggerService {\r\n    constructor(private configurationProvider: ConfigurationProvider) {}\r\n\r\n    logError(message: any, ...args: any[]) {\r\n        console.error(message, ...args);\r\n    }\r\n\r\n    logWarning(message: any) {\r\n        if (this.configurationProvider.openIDConfiguration.log_console_warning_active) {\r\n            console.warn(message);\r\n        }\r\n    }\r\n\r\n    logDebug(message: any) {\r\n        if (this.configurationProvider.openIDConfiguration.log_console_debug_active) {\r\n            console.log(message);\r\n        }\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { LoggerService } from './oidc.logger.service';\r\n\r\n@Injectable()\r\nexport class IFrameService {\r\n    constructor(private loggerService: LoggerService) {}\r\n\r\n    getExistingIFrame(identifier: string): HTMLIFrameElement | null {\r\n        const iFrameOnParent = this.getIFrameFromParentWindow(identifier);\r\n        if (this.isIFrameElement(iFrameOnParent)) {\r\n            return iFrameOnParent;\r\n        }\r\n        const iFrameOnSelf = this.getIFrameFromWindow(identifier);\r\n        if (this.isIFrameElement(iFrameOnSelf)) {\r\n            return iFrameOnSelf;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    addIFrameToWindowBody(identifier: string): HTMLIFrameElement {\r\n        const sessionIframe = window.document.createElement('iframe');\r\n        sessionIframe.id = identifier;\r\n        this.loggerService.logDebug(sessionIframe);\r\n        sessionIframe.style.display = 'none';\r\n        window.document.body.appendChild(sessionIframe);\r\n        return sessionIframe;\r\n    }\r\n\r\n    private getIFrameFromParentWindow(identifier: string): HTMLIFrameElement | null {\r\n        try {\r\n            const iFrameElement = window.parent.document.getElementById(identifier);\r\n            if (this.isIFrameElement(iFrameElement)) {\r\n                return iFrameElement;\r\n            }\r\n            return null;\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    private getIFrameFromWindow(identifier: string): HTMLIFrameElement | null {\r\n        const iFrameElement = window.document.getElementById(identifier);\r\n        if (this.isIFrameElement(iFrameElement)) {\r\n            return iFrameElement;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private isIFrameElement(element: HTMLElement | null): element is HTMLIFrameElement {\r\n        return !!element && element instanceof HTMLIFrameElement;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable()\r\nexport class EqualityHelperService {\r\n    areEqual(value1: string | any[] | object | null | undefined, value2: string | any[] | object | null | undefined) {\r\n        if (!value1 || !value2) {\r\n            return false;\r\n        }\r\n\r\n        if (this.bothValuesAreArrays(value1, value2)) {\r\n            return this.arraysEqual(value1 as any[], value2 as any[]);\r\n        }\r\n\r\n        if (this.bothValuesAreStrings(value1, value2)) {\r\n            return value1 === value2;\r\n        }\r\n\r\n        if (this.bothValuesAreObjects(value1, value2)) {\r\n            return JSON.stringify(value1).toLowerCase() === JSON.stringify(value2).toLowerCase();\r\n        }\r\n\r\n        if (this.oneValueIsStringAndTheOtherIsArray(value1, value2)) {\r\n            if (Array.isArray(value1) && this.valueIsString(value2)) {\r\n                return value1[0] === value2;\r\n            }\r\n            if (Array.isArray(value2) && this.valueIsString(value1)) {\r\n                return value2[0] === value1;\r\n            }\r\n        }\r\n    }\r\n\r\n    private oneValueIsStringAndTheOtherIsArray(value1: string | object | any[], value2: string | object | any[]) {\r\n        return (Array.isArray(value1) && this.valueIsString(value2)) || (Array.isArray(value2) && this.valueIsString(value1));\r\n    }\r\n\r\n    private bothValuesAreObjects(value1: string | object | any[], value2: string | object | any[]) {\r\n        return this.valueIsObject(value1) && this.valueIsObject(value2);\r\n    }\r\n\r\n    private bothValuesAreStrings(value1: string | object | any[], value2: string | object | any[]) {\r\n        return this.valueIsString(value1) && this.valueIsString(value2);\r\n    }\r\n\r\n    private bothValuesAreArrays(value1: string | object | any[], value2: string | object | any[]) {\r\n        return Array.isArray(value1) && Array.isArray(value2);\r\n    }\r\n\r\n    private valueIsString(value: any) {\r\n        return typeof value === 'string' || value instanceof String;\r\n    }\r\n\r\n    private valueIsObject(value: any) {\r\n        return typeof value === 'object';\r\n    }\r\n\r\n    private arraysEqual(arr1: Array<string>, arr2: Array<string>) {\r\n        if (arr1.length !== arr2.length) {\r\n            return false;\r\n        }\r\n\r\n        for (let i = arr1.length; i--; ) {\r\n            if (arr1[i] !== arr2[i]) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { LoggerService } from './oidc.logger.service';\r\n\r\n@Injectable()\r\nexport class TokenHelperService {\r\n    private PARTS_OF_TOKEN = 3;\r\n    constructor(private readonly loggerService: LoggerService) {}\r\n\r\n    getTokenExpirationDate(dataIdToken: any): Date {\r\n        if (!dataIdToken.hasOwnProperty('exp')) {\r\n            return new Date();\r\n        }\r\n\r\n        const date = new Date(0); // The 0 here is the key, which sets the date to the epoch\r\n        date.setUTCSeconds(dataIdToken.exp);\r\n\r\n        return date;\r\n    }\r\n\r\n    getHeaderFromToken(token: any, encoded: boolean) {\r\n        if (!this.tokenIsValid(token)) {\r\n            return {};\r\n        }\r\n\r\n        return this.getPartOfToken(token, 0, encoded);\r\n    }\r\n\r\n    getPayloadFromToken(token: any, encoded: boolean) {\r\n        if (!this.tokenIsValid(token)) {\r\n            return {};\r\n        }\r\n\r\n        return this.getPartOfToken(token, 1, encoded);\r\n    }\r\n\r\n    getSignatureFromToken(token: any, encoded: boolean) {\r\n        if (!this.tokenIsValid(token)) {\r\n            return {};\r\n        }\r\n\r\n        return this.getPartOfToken(token, 2, encoded);\r\n    }\r\n\r\n    private getPartOfToken(token: string, index: number, encoded: boolean) {\r\n        const partOfToken = this.extractPartOfToken(token, index);\r\n\r\n        if (encoded) {\r\n            return partOfToken;\r\n        }\r\n\r\n        const result = this.urlBase64Decode(partOfToken);\r\n        return JSON.parse(result);\r\n    }\r\n\r\n    private urlBase64Decode(str: string) {\r\n        let output = str.replace(/-/g, '+').replace(/_/g, '/');\r\n\r\n        switch (output.length % 4) {\r\n            case 0:\r\n                break;\r\n            case 2:\r\n                output += '==';\r\n                break;\r\n            case 3:\r\n                output += '=';\r\n                break;\r\n            default:\r\n                throw Error('Illegal base64url string!');\r\n        }\r\n\r\n        const decoded = typeof window !== 'undefined' ? window.atob(output) : new Buffer(output, 'base64').toString('binary');\r\n\r\n        try {\r\n            // Going backwards: from bytestream, to percent-encoding, to original string.\r\n            return decodeURIComponent(\r\n                decoded\r\n                    .split('')\r\n                    .map((c: string) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\r\n                    .join('')\r\n            );\r\n        } catch (err) {\r\n            return decoded;\r\n        }\r\n    }\r\n\r\n    private tokenIsValid(token: string) {\r\n        if (!token) {\r\n            this.loggerService.logError(`token '${token}' is not valid --> token falsy`);\r\n            return false;\r\n        }\r\n\r\n        if (!(token as string).includes('.')) {\r\n            this.loggerService.logError(`token '${token}' is not valid --> no dots included`);\r\n            return false;\r\n        }\r\n\r\n        const parts = token.split('.');\r\n\r\n        if (parts.length !== this.PARTS_OF_TOKEN) {\r\n            this.loggerService.logError(`token '${token}' is not valid --> token has to have exactly ${this.PARTS_OF_TOKEN} dots`);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private extractPartOfToken(token: string, index: number) {\r\n        return token.split('.')[index];\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ConfigurationProvider } from './auth-configuration.provider';\r\n\r\n/**\r\n * Implement this class-interface to create a custom storage.\r\n */\r\n@Injectable()\r\nexport abstract class OidcSecurityStorage {\r\n    /**\r\n     * This method must contain the logic to read the storage.\r\n     * @return The value of the given key\r\n     */\r\n    public abstract read(key: string): any;\r\n\r\n    /**\r\n     * This method must contain the logic to write the storage.\r\n     * @param value The value for the given key\r\n     */\r\n    public abstract write(key: string, value: any): void;\r\n}\r\n\r\n@Injectable()\r\nexport class BrowserStorage implements OidcSecurityStorage {\r\n    private hasStorage: boolean;\r\n\r\n    constructor(private configProvider: ConfigurationProvider) {\r\n        this.hasStorage = typeof Storage !== 'undefined';\r\n    }\r\n\r\n    public read(key: string): any {\r\n        if (this.hasStorage) {\r\n            return JSON.parse(this.configProvider.openIDConfiguration.storage.getItem(key + '_' + this.configProvider.openIDConfiguration.client_id));\r\n        }\r\n\r\n        return;\r\n    }\r\n\r\n    public write(key: string, value: any): void {\r\n        if (this.hasStorage) {\r\n            value = value === undefined ? null : value;\r\n            this.configProvider.openIDConfiguration.storage.setItem(\r\n                key + '_' + this.configProvider.openIDConfiguration.client_id,\r\n                JSON.stringify(value)\r\n            );\r\n        }\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { OidcSecurityStorage } from './oidc.security.storage';\r\n\r\nexport type SilentRenewState = 'running' | '';\r\n\r\n@Injectable()\r\nexport class OidcSecurityCommon {\r\n    private storageAuthResult = 'authorizationResult';\r\n\r\n    public get authResult(): any {\r\n        return this.retrieve(this.storageAuthResult);\r\n    }\r\n\r\n    public set authResult(value: any) {\r\n        this.store(this.storageAuthResult, value);\r\n    }\r\n\r\n    private storageAccessToken = 'authorizationData';\r\n\r\n    public get accessToken(): string {\r\n        return this.retrieve(this.storageAccessToken) || '';\r\n    }\r\n\r\n    public set accessToken(value: string) {\r\n        this.store(this.storageAccessToken, value);\r\n    }\r\n\r\n    private storageIdToken = 'authorizationDataIdToken';\r\n\r\n    public get idToken(): string {\r\n        return this.retrieve(this.storageIdToken) || '';\r\n    }\r\n\r\n    public set idToken(value: string) {\r\n        this.store(this.storageIdToken, value);\r\n    }\r\n\r\n    private storageIsAuthorized = '_isAuthorized';\r\n\r\n    public get isAuthorized(): boolean | undefined {\r\n        return this.retrieve(this.storageIsAuthorized);\r\n    }\r\n\r\n    public set isAuthorized(value: boolean | undefined) {\r\n        this.store(this.storageIsAuthorized, value);\r\n    }\r\n\r\n    private storageUserData = 'userData';\r\n\r\n    public get userData(): any {\r\n        return this.retrieve(this.storageUserData);\r\n    }\r\n\r\n    public set userData(value: any) {\r\n        this.store(this.storageUserData, value);\r\n    }\r\n\r\n    private storageAuthNonce = 'authNonce';\r\n\r\n    public get authNonce(): string {\r\n        return this.retrieve(this.storageAuthNonce) || '';\r\n    }\r\n\r\n    public set authNonce(value: string) {\r\n        this.store(this.storageAuthNonce, value);\r\n    }\r\n\r\n    private storageCodeVerifier = 'code_verifier';\r\n\r\n    public get code_verifier(): string {\r\n        return this.retrieve(this.storageCodeVerifier) || '';\r\n    }\r\n\r\n    public set code_verifier(value: string) {\r\n        this.store(this.storageCodeVerifier, value);\r\n    }\r\n\r\n    private storageAuthStateControl = 'authStateControl';\r\n\r\n    public get authStateControl(): string {\r\n        return this.retrieve(this.storageAuthStateControl) || '';\r\n    }\r\n\r\n    public set authStateControl(value: string) {\r\n        this.store(this.storageAuthStateControl, value);\r\n    }\r\n\r\n    private storageSessionState = 'session_state';\r\n\r\n    public get sessionState(): any {\r\n        return this.retrieve(this.storageSessionState);\r\n    }\r\n\r\n    public set sessionState(value: any) {\r\n        this.store(this.storageSessionState, value);\r\n    }\r\n\r\n    private storageSilentRenewRunning = 'storage_silent_renew_running';\r\n\r\n    public get silentRenewRunning(): SilentRenewState {\r\n        return this.retrieve(this.storageSilentRenewRunning) || '';\r\n    }\r\n\r\n    public set silentRenewRunning(value: SilentRenewState) {\r\n        this.store(this.storageSilentRenewRunning, value);\r\n    }\r\n\r\n    private storageCustomRequestParams = 'storage_custom_request_params';\r\n\r\n    public get customRequestParams(): {\r\n        [key: string]: string | number | boolean;\r\n    } {\r\n        return this.retrieve(this.storageCustomRequestParams);\r\n    }\r\n\r\n    public set customRequestParams(value: { [key: string]: string | number | boolean }) {\r\n        this.store(this.storageCustomRequestParams, value);\r\n    }\r\n\r\n    constructor(private oidcSecurityStorage: OidcSecurityStorage) {}\r\n\r\n    private retrieve(key: string): any {\r\n        return this.oidcSecurityStorage.read(key);\r\n    }\r\n\r\n    private store(key: string, value: any) {\r\n        this.oidcSecurityStorage.write(key, value);\r\n    }\r\n\r\n    resetStorageData(isRenewProcess: boolean) {\r\n        if (!isRenewProcess) {\r\n            this.store(this.storageAuthResult, '');\r\n            this.store(this.storageSessionState, '');\r\n            this.store(this.storageSilentRenewRunning, '');\r\n            this.store(this.storageIsAuthorized, false);\r\n            this.store(this.storageAccessToken, '');\r\n            this.store(this.storageIdToken, '');\r\n            this.store(this.storageUserData, '');\r\n            this.store(this.storageCodeVerifier, '');\r\n        }\r\n    }\r\n\r\n    getAccessToken(): any {\r\n        return this.retrieve(this.storageAccessToken);\r\n    }\r\n\r\n    getIdToken(): any {\r\n        return this.retrieve(this.storageIdToken);\r\n    }\r\n\r\n    getRefreshToken(): any {\r\n        return this.authResult.refresh_token;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { hextob64u, KEYUTIL, KJUR } from 'jsrsasign-reduced';\r\nimport { EqualityHelperService } from './oidc-equality-helper.service';\r\nimport { TokenHelperService } from './oidc-token-helper.service';\r\nimport { LoggerService } from './oidc.logger.service';\r\n\r\n// http://openid.net/specs/openid-connect-implicit-1_0.html\r\n\r\n// id_token\r\n// id_token C1: The Issuer Identifier for the OpenID Provider (which is typically obtained during Discovery)\r\n// MUST exactly match the value of the iss (issuer) Claim.\r\n//\r\n// id_token C2: The Client MUST validate that the aud (audience) Claim contains its client_id value registered at the Issuer identified\r\n// by the iss (issuer) Claim as an audience.The ID Token MUST be rejected if the ID Token does not list the Client as a valid audience,\r\n// or if it contains additional audiences not trusted by the Client.\r\n//\r\n// id_token C3: If the ID Token contains multiple audiences, the Client SHOULD verify that an azp Claim is present.\r\n//\r\n// id_token C4: If an azp (authorized party) Claim is present, the Client SHOULD verify that its client_id is the Claim Value.\r\n//\r\n// id_token C5: The Client MUST validate the signature of the ID Token according to JWS [JWS] using the algorithm specified in the\r\n// alg Header Parameter of the JOSE Header.The Client MUST use the keys provided by the Issuer.\r\n//\r\n// id_token C6: The alg value SHOULD be RS256. Validation of tokens using other signing algorithms is described in the OpenID Connect Core 1.0\r\n// [OpenID.Core] specification.\r\n//\r\n// id_token C7: The current time MUST be before the time represented by the exp Claim (possibly allowing for some small leeway to account\r\n// for clock skew).\r\n//\r\n// id_token C8: The iat Claim can be used to reject tokens that were issued too far away from the current time,\r\n// limiting the amount of time that nonces need to be stored to prevent attacks.The acceptable range is Client specific.\r\n//\r\n// id_token C9: The value of the nonce Claim MUST be checked to verify that it is the same value as the one that was sent\r\n// in the Authentication Request.The Client SHOULD check the nonce value for replay attacks.The precise method for detecting replay attacks\r\n// is Client specific.\r\n//\r\n// id_token C10: If the acr Claim was requested, the Client SHOULD check that the asserted Claim Value is appropriate.\r\n// The meaning and processing of acr Claim Values is out of scope for this document.\r\n//\r\n// id_token C11: When a max_age request is made, the Client SHOULD check the auth_time Claim value and request re- authentication\r\n// if it determines too much time has elapsed since the last End- User authentication.\r\n\r\n// Access Token Validation\r\n// access_token C1: Hash the octets of the ASCII representation of the access_token with the hash algorithm specified in JWA[JWA]\r\n// for the alg Header Parameter of the ID Token's JOSE Header. For instance, if the alg is RS256, the hash algorithm used is SHA-256.\r\n// access_token C2: Take the left- most half of the hash and base64url- encode it.\r\n// access_token C3: The value of at_hash in the ID Token MUST match the value produced in the previous step if at_hash is present in the ID Token.\r\n\r\n@Injectable()\r\nexport class OidcSecurityValidation {\r\n    static RefreshTokenNoncePlaceholder = '--RefreshToken--';\r\n\r\n    constructor(\r\n        private arrayHelperService: EqualityHelperService,\r\n        private tokenHelperService: TokenHelperService,\r\n        private loggerService: LoggerService\r\n    ) {}\r\n\r\n    // id_token C7: The current time MUST be before the time represented by the exp Claim\r\n    // (possibly allowing for some small leeway to account for clock skew).\r\n    isTokenExpired(token: string, offsetSeconds?: number): boolean {\r\n        let decoded: any;\r\n        decoded = this.tokenHelperService.getPayloadFromToken(token, false);\r\n\r\n        return !this.validate_id_token_exp_not_expired(decoded, offsetSeconds);\r\n    }\r\n\r\n    // id_token C7: The current time MUST be before the time represented by the exp Claim\r\n    // (possibly allowing for some small leeway to account for clock skew).\r\n    // tslint:disable-next-line: variable-name\r\n    validate_id_token_exp_not_expired(decoded_id_token: string, offsetSeconds?: number): boolean {\r\n        const tokenExpirationDate = this.tokenHelperService.getTokenExpirationDate(decoded_id_token);\r\n        offsetSeconds = offsetSeconds || 0;\r\n\r\n        if (!tokenExpirationDate) {\r\n            return false;\r\n        }\r\n\r\n        const tokenExpirationValue = tokenExpirationDate.valueOf();\r\n        const nowWithOffset = new Date().valueOf() + offsetSeconds * 1000;\r\n        const tokenNotExpired = tokenExpirationValue > nowWithOffset;\r\n\r\n        this.loggerService.logDebug(`Token not expired?: ${tokenExpirationValue} > ${nowWithOffset}  (${tokenNotExpired})`);\r\n\r\n        // Token not expired?\r\n        return tokenNotExpired;\r\n    }\r\n\r\n    // iss\r\n    // REQUIRED. Issuer Identifier for the Issuer of the response.The iss value is a case-sensitive URL using the\r\n    // https scheme that contains scheme, host,\r\n    // and optionally, port number and path components and no query or fragment components.\r\n    //\r\n    // sub\r\n    // REQUIRED. Subject Identifier.Locally unique and never reassigned identifier within the Issuer for the End- User,\r\n    // which is intended to be consumed by the Client, e.g., 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4.\r\n    // It MUST NOT exceed 255 ASCII characters in length.The sub value is a case-sensitive string.\r\n    //\r\n    // aud\r\n    // REQUIRED. Audience(s) that this ID Token is intended for. It MUST contain the OAuth 2.0 client_id of the Relying Party as an audience value.\r\n    // It MAY also contain identifiers for other audiences.In the general case, the aud value is an array of case-sensitive strings.\r\n    // In the common special case when there is one audience, the aud value MAY be a single case-sensitive string.\r\n    //\r\n    // exp\r\n    // REQUIRED. Expiration time on or after which the ID Token MUST NOT be accepted for processing.\r\n    // The processing of this parameter requires that the current date/ time MUST be before the expiration date/ time listed in the value.\r\n    // Implementers MAY provide for some small leeway, usually no more than a few minutes, to account for clock skew.\r\n    // Its value is a JSON [RFC7159] number representing the number of seconds from 1970- 01 - 01T00: 00:00Z as measured in UTC until the date/ time.\r\n    // See RFC 3339 [RFC3339] for details regarding date/ times in general and UTC in particular.\r\n    //\r\n    // iat\r\n    // REQUIRED. Time at which the JWT was issued. Its value is a JSON number representing the number of seconds from\r\n    // 1970- 01 - 01T00: 00: 00Z as measured\r\n    // in UTC until the date/ time.\r\n    validate_required_id_token(dataIdToken: any): boolean {\r\n        let validated = true;\r\n        if (!dataIdToken.hasOwnProperty('iss')) {\r\n            validated = false;\r\n            this.loggerService.logWarning('iss is missing, this is required in the id_token');\r\n        }\r\n\r\n        if (!dataIdToken.hasOwnProperty('sub')) {\r\n            validated = false;\r\n            this.loggerService.logWarning('sub is missing, this is required in the id_token');\r\n        }\r\n\r\n        if (!dataIdToken.hasOwnProperty('aud')) {\r\n            validated = false;\r\n            this.loggerService.logWarning('aud is missing, this is required in the id_token');\r\n        }\r\n\r\n        if (!dataIdToken.hasOwnProperty('exp')) {\r\n            validated = false;\r\n            this.loggerService.logWarning('exp is missing, this is required in the id_token');\r\n        }\r\n\r\n        if (!dataIdToken.hasOwnProperty('iat')) {\r\n            validated = false;\r\n            this.loggerService.logWarning('iat is missing, this is required in the id_token');\r\n        }\r\n\r\n        return validated;\r\n    }\r\n\r\n    // id_token C8: The iat Claim can be used to reject tokens that were issued too far away from the current time,\r\n    // limiting the amount of time that nonces need to be stored to prevent attacks.The acceptable range is Client specific.\r\n    validate_id_token_iat_max_offset(dataIdToken: any, maxOffsetAllowedInSeconds: number, disableIatOffsetValidation: boolean): boolean {\r\n        if (disableIatOffsetValidation) {\r\n            return true;\r\n        }\r\n\r\n        if (!dataIdToken.hasOwnProperty('iat')) {\r\n            return false;\r\n        }\r\n\r\n        const dateTimeIatIdToken = new Date(0); // The 0 here is the key, which sets the date to the epoch\r\n        dateTimeIatIdToken.setUTCSeconds(dataIdToken.iat);\r\n\r\n        maxOffsetAllowedInSeconds = maxOffsetAllowedInSeconds || 0;\r\n\r\n        if (dateTimeIatIdToken == null) {\r\n            return false;\r\n        }\r\n\r\n        this.loggerService.logDebug(\r\n            'validate_id_token_iat_max_offset: ' + (new Date().valueOf() - dateTimeIatIdToken.valueOf()) + ' < ' + maxOffsetAllowedInSeconds * 1000\r\n        );\r\n        return new Date().valueOf() - dateTimeIatIdToken.valueOf() < maxOffsetAllowedInSeconds * 1000;\r\n    }\r\n\r\n    // id_token C9: The value of the nonce Claim MUST be checked to verify that it is the same value as the one\r\n    // that was sent in the Authentication Request.The Client SHOULD check the nonce value for replay attacks.\r\n    // The precise method for detecting replay attacks is Client specific.\r\n\r\n    // However the nonce claim SHOULD not be present for the refesh_token grant type\r\n    // https://bitbucket.org/openid/connect/issues/1025/ambiguity-with-how-nonce-is-handled-on\r\n    // The current spec is ambiguous and Keycloak does send it.\r\n    validate_id_token_nonce(dataIdToken: any, localNonce: any, ignoreNonceAfterRefresh: boolean): boolean {\r\n        const isFromRefreshToken =\r\n            (dataIdToken.nonce === undefined || ignoreNonceAfterRefresh) && localNonce === OidcSecurityValidation.RefreshTokenNoncePlaceholder;\r\n        if (!isFromRefreshToken && dataIdToken.nonce !== localNonce) {\r\n            this.loggerService.logDebug('Validate_id_token_nonce failed, dataIdToken.nonce: ' + dataIdToken.nonce + ' local_nonce:' + localNonce);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    // id_token C1: The Issuer Identifier for the OpenID Provider (which is typically obtained during Discovery)\r\n    // MUST exactly match the value of the iss (issuer) Claim.\r\n    // tslint:disable-next-line: variable-name\r\n    validate_id_token_iss(dataIdToken: any, authWellKnownEndpoints_issuer: any): boolean {\r\n        if ((dataIdToken.iss as string) !== (authWellKnownEndpoints_issuer as string)) {\r\n            this.loggerService.logDebug(\r\n                'Validate_id_token_iss failed, dataIdToken.iss: ' +\r\n                    dataIdToken.iss +\r\n                    ' authWellKnownEndpoints issuer:' +\r\n                    authWellKnownEndpoints_issuer\r\n            );\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    // id_token C2: The Client MUST validate that the aud (audience) Claim contains its client_id value registered at the Issuer identified\r\n    // by the iss (issuer) Claim as an audience.\r\n    // The ID Token MUST be rejected if the ID Token does not list the Client as a valid audience, or if it contains additional audiences\r\n    // not trusted by the Client.\r\n    validate_id_token_aud(dataIdToken: any, aud: any): boolean {\r\n        if (dataIdToken.aud instanceof Array) {\r\n            const result = this.arrayHelperService.areEqual(dataIdToken.aud, aud);\r\n\r\n            if (!result) {\r\n                this.loggerService.logDebug('Validate_id_token_aud  array failed, dataIdToken.aud: ' + dataIdToken.aud + ' client_id:' + aud);\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        } else if (dataIdToken.aud !== aud) {\r\n            this.loggerService.logDebug('Validate_id_token_aud failed, dataIdToken.aud: ' + dataIdToken.aud + ' client_id:' + aud);\r\n\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    validateStateFromHashCallback(state: any, localState: any): boolean {\r\n        if ((state as string) !== (localState as string)) {\r\n            this.loggerService.logDebug('ValidateStateFromHashCallback failed, state: ' + state + ' local_state:' + localState);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    validate_userdata_sub_id_token(idTokenSub: any, userdataSub: any): boolean {\r\n        if ((idTokenSub as string) !== (userdataSub as string)) {\r\n            this.loggerService.logDebug('validate_userdata_sub_id_token failed, id_token_sub: ' + idTokenSub + ' userdata_sub:' + userdataSub);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    // id_token C5: The Client MUST validate the signature of the ID Token according to JWS [JWS] using the algorithm specified in the alg\r\n    // Header Parameter of the JOSE Header.The Client MUST use the keys provided by the Issuer.\r\n    // id_token C6: The alg value SHOULD be RS256. Validation of tokens using other signing algorithms is described in the\r\n    // OpenID Connect Core 1.0 [OpenID.Core] specification.\r\n    validate_signature_id_token(idToken: any, jwtkeys: any): boolean {\r\n        if (!jwtkeys || !jwtkeys.keys) {\r\n            return false;\r\n        }\r\n\r\n        const headerData = this.tokenHelperService.getHeaderFromToken(idToken, false);\r\n\r\n        if (Object.keys(headerData).length === 0 && headerData.constructor === Object) {\r\n            this.loggerService.logWarning('id token has no header data');\r\n            return false;\r\n        }\r\n\r\n        const kid = headerData.kid;\r\n        const alg = headerData.alg;\r\n\r\n        if ('RS256' !== (alg as string)) {\r\n            this.loggerService.logWarning('Only RS256 supported');\r\n            return false;\r\n        }\r\n\r\n        let isValid = false;\r\n\r\n        if (!headerData.hasOwnProperty('kid')) {\r\n            // exactly 1 key in the jwtkeys and no kid in the Jose header\r\n            // kty\t\"RSA\" use \"sig\"\r\n            let amountOfMatchingKeys = 0;\r\n            for (const key of jwtkeys.keys) {\r\n                if ((key.kty as string) === 'RSA' && (key.use as string) === 'sig') {\r\n                    amountOfMatchingKeys = amountOfMatchingKeys + 1;\r\n                }\r\n            }\r\n\r\n            if (amountOfMatchingKeys === 0) {\r\n                this.loggerService.logWarning('no keys found, incorrect Signature, validation failed for id_token');\r\n                return false;\r\n            } else if (amountOfMatchingKeys > 1) {\r\n                this.loggerService.logWarning('no ID Token kid claim in JOSE header and multiple supplied in jwks_uri');\r\n                return false;\r\n            } else {\r\n                for (const key of jwtkeys.keys) {\r\n                    if ((key.kty as string) === 'RSA' && (key.use as string) === 'sig') {\r\n                        const publickey = KEYUTIL.getKey(key);\r\n                        isValid = KJUR.jws.JWS.verify(idToken, publickey, ['RS256']);\r\n                        if (!isValid) {\r\n                            this.loggerService.logWarning('incorrect Signature, validation failed for id_token');\r\n                        }\r\n                        return isValid;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            // kid in the Jose header of id_token\r\n            for (const key of jwtkeys.keys) {\r\n                if ((key.kid as string) === (kid as string)) {\r\n                    const publickey = KEYUTIL.getKey(key);\r\n                    isValid = KJUR.jws.JWS.verify(idToken, publickey, ['RS256']);\r\n                    if (!isValid) {\r\n                        this.loggerService.logWarning('incorrect Signature, validation failed for id_token');\r\n                    }\r\n                    return isValid;\r\n                }\r\n            }\r\n        }\r\n\r\n        return isValid;\r\n    }\r\n\r\n    config_validate_response_type(responseType: string): boolean {\r\n        if (responseType === 'id_token token' || responseType === 'id_token') {\r\n            return true;\r\n        }\r\n\r\n        if (responseType === 'code') {\r\n            return true;\r\n        }\r\n\r\n        this.loggerService.logWarning('module configure incorrect, invalid response_type:' + responseType);\r\n        return false;\r\n    }\r\n\r\n    // Accepts ID Token without 'kid' claim in JOSE header if only one JWK supplied in 'jwks_url'\r\n    //// private validate_no_kid_in_header_only_one_allowed_in_jwtkeys(header_data: any, jwtkeys: any): boolean {\r\n    ////    this.oidcSecurityCommon.logDebug('amount of jwtkeys.keys: ' + jwtkeys.keys.length);\r\n    ////    if (!header_data.hasOwnProperty('kid')) {\r\n    ////        // no kid defined in Jose header\r\n    ////        if (jwtkeys.keys.length != 1) {\r\n    ////            this.oidcSecurityCommon.logDebug('jwtkeys.keys.length != 1 and no kid in header');\r\n    ////            return false;\r\n    ////        }\r\n    ////    }\r\n\r\n    ////    return true;\r\n    //// }\r\n\r\n    // Access Token Validation\r\n    // access_token C1: Hash the octets of the ASCII representation of the access_token with the hash algorithm specified in JWA[JWA]\r\n    // for the alg Header Parameter of the ID Token's JOSE Header. For instance, if the alg is RS256, the hash algorithm used is SHA-256.\r\n    // access_token C2: Take the left- most half of the hash and base64url- encode it.\r\n    // access_token C3: The value of at_hash in the ID Token MUST match the value produced in the previous step if at_hash\r\n    // is present in the ID Token.\r\n    validate_id_token_at_hash(accessToken: any, atHash: any, isCodeFlow: boolean): boolean {\r\n        this.loggerService.logDebug('at_hash from the server:' + atHash);\r\n\r\n        // The at_hash is optional for the code flow\r\n        if (isCodeFlow) {\r\n            if (!(atHash as string)) {\r\n                this.loggerService.logDebug('Code Flow active, and no at_hash in the id_token, skipping check!');\r\n                return true;\r\n            }\r\n        }\r\n\r\n        const testdata = this.generate_at_hash('' + accessToken);\r\n        this.loggerService.logDebug('at_hash client validation not decoded:' + testdata);\r\n        if (testdata === (atHash as string)) {\r\n            return true; // isValid;\r\n        } else {\r\n            const testValue = this.generate_at_hash('' + decodeURIComponent(accessToken));\r\n            this.loggerService.logDebug('-gen access--' + testValue);\r\n            if (testValue === (atHash as string)) {\r\n                return true; // isValid\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private generate_at_hash(accessToken: any): string {\r\n        const hash = KJUR.crypto.Util.hashString(accessToken, 'sha256');\r\n        const first128bits = hash.substr(0, hash.length / 2);\r\n        const testdata = hextob64u(first128bits);\r\n\r\n        return testdata;\r\n    }\r\n\r\n    generate_code_verifier(codeChallenge: any): string {\r\n        const hash = KJUR.crypto.Util.hashString(codeChallenge, 'sha256');\r\n        const testdata = hextob64u(hash);\r\n\r\n        return testdata;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { JwtKeys } from '../models/jwtkeys';\r\nimport { ValidateStateResult } from '../models/validate-state-result.model';\r\nimport { ValidationResult } from '../models/validation-result.enum';\r\nimport { ConfigurationProvider } from './auth-configuration.provider';\r\nimport { TokenHelperService } from './oidc-token-helper.service';\r\nimport { LoggerService } from './oidc.logger.service';\r\nimport { OidcSecurityCommon } from './oidc.security.common';\r\nimport { OidcSecurityValidation } from './oidc.security.validation';\r\n\r\n@Injectable()\r\nexport class StateValidationService {\r\n    constructor(\r\n        public oidcSecurityCommon: OidcSecurityCommon,\r\n        private oidcSecurityValidation: OidcSecurityValidation,\r\n        private tokenHelperService: TokenHelperService,\r\n        private loggerService: LoggerService,\r\n        private readonly configurationProvider: ConfigurationProvider\r\n    ) {}\r\n\r\n    validateState(result: any, jwtKeys: JwtKeys): ValidateStateResult {\r\n        const toReturn = new ValidateStateResult();\r\n        if (!this.oidcSecurityValidation.validateStateFromHashCallback(result.state, this.oidcSecurityCommon.authStateControl)) {\r\n            this.loggerService.logWarning('authorizedCallback incorrect state');\r\n            toReturn.state = ValidationResult.StatesDoNotMatch;\r\n            this.handleUnsuccessfulValidation();\r\n            return toReturn;\r\n        }\r\n\r\n        if (\r\n            this.configurationProvider.openIDConfiguration.response_type === 'id_token token' ||\r\n            this.configurationProvider.openIDConfiguration.response_type === 'code'\r\n        ) {\r\n            toReturn.access_token = result.access_token;\r\n        }\r\n\r\n        if (result.id_token) {\r\n            toReturn.id_token = result.id_token;\r\n\r\n            toReturn.decoded_id_token = this.tokenHelperService.getPayloadFromToken(toReturn.id_token, false);\r\n\r\n            if (!this.oidcSecurityValidation.validate_signature_id_token(toReturn.id_token, jwtKeys)) {\r\n                this.loggerService.logDebug('authorizedCallback Signature validation failed id_token');\r\n                toReturn.state = ValidationResult.SignatureFailed;\r\n                this.handleUnsuccessfulValidation();\r\n                return toReturn;\r\n            }\r\n\r\n            if (\r\n                !this.oidcSecurityValidation.validate_id_token_nonce(\r\n                    toReturn.decoded_id_token,\r\n                    this.oidcSecurityCommon.authNonce,\r\n                    this.configurationProvider.openIDConfiguration.ignore_nonce_after_refresh\r\n                )\r\n            ) {\r\n                this.loggerService.logWarning('authorizedCallback incorrect nonce');\r\n                toReturn.state = ValidationResult.IncorrectNonce;\r\n                this.handleUnsuccessfulValidation();\r\n                return toReturn;\r\n            }\r\n\r\n            if (!this.oidcSecurityValidation.validate_required_id_token(toReturn.decoded_id_token)) {\r\n                this.loggerService.logDebug('authorizedCallback Validation, one of the REQUIRED properties missing from id_token');\r\n                toReturn.state = ValidationResult.RequiredPropertyMissing;\r\n                this.handleUnsuccessfulValidation();\r\n                return toReturn;\r\n            }\r\n\r\n            if (\r\n                !this.oidcSecurityValidation.validate_id_token_iat_max_offset(\r\n                    toReturn.decoded_id_token,\r\n                    this.configurationProvider.openIDConfiguration.max_id_token_iat_offset_allowed_in_seconds,\r\n                    this.configurationProvider.openIDConfiguration.disable_iat_offset_validation\r\n                )\r\n            ) {\r\n                this.loggerService.logWarning('authorizedCallback Validation, iat rejected id_token was issued too far away from the current time');\r\n                toReturn.state = ValidationResult.MaxOffsetExpired;\r\n                this.handleUnsuccessfulValidation();\r\n                return toReturn;\r\n            }\r\n\r\n            if (this.configurationProvider.wellKnownEndpoints) {\r\n                if (this.configurationProvider.openIDConfiguration.iss_validation_off) {\r\n                    this.loggerService.logDebug('iss validation is turned off, this is not recommended!');\r\n                } else if (\r\n                    !this.configurationProvider.openIDConfiguration.iss_validation_off &&\r\n                    !this.oidcSecurityValidation.validate_id_token_iss(\r\n                        toReturn.decoded_id_token,\r\n                        this.configurationProvider.wellKnownEndpoints.issuer\r\n                    )\r\n                ) {\r\n                    this.loggerService.logWarning('authorizedCallback incorrect iss does not match authWellKnownEndpoints issuer');\r\n                    toReturn.state = ValidationResult.IssDoesNotMatchIssuer;\r\n                    this.handleUnsuccessfulValidation();\r\n                    return toReturn;\r\n                }\r\n            } else {\r\n                this.loggerService.logWarning('authWellKnownEndpoints is undefined');\r\n                toReturn.state = ValidationResult.NoAuthWellKnownEndPoints;\r\n                this.handleUnsuccessfulValidation();\r\n                return toReturn;\r\n            }\r\n\r\n            if (\r\n                !this.oidcSecurityValidation.validate_id_token_aud(\r\n                    toReturn.decoded_id_token,\r\n                    this.configurationProvider.openIDConfiguration.client_id\r\n                )\r\n            ) {\r\n                this.loggerService.logWarning('authorizedCallback incorrect aud');\r\n                toReturn.state = ValidationResult.IncorrectAud;\r\n                this.handleUnsuccessfulValidation();\r\n                return toReturn;\r\n            }\r\n\r\n            if (!this.oidcSecurityValidation.validate_id_token_exp_not_expired(toReturn.decoded_id_token)) {\r\n                this.loggerService.logWarning('authorizedCallback token expired');\r\n                toReturn.state = ValidationResult.TokenExpired;\r\n                this.handleUnsuccessfulValidation();\r\n                return toReturn;\r\n            }\r\n        } else {\r\n            this.loggerService.logDebug('No id_token found, skipping id_token validation');\r\n        }\r\n\r\n        // flow id_token token\r\n        if (\r\n            this.configurationProvider.openIDConfiguration.response_type !== 'id_token token' &&\r\n            this.configurationProvider.openIDConfiguration.response_type !== 'code'\r\n        ) {\r\n            toReturn.authResponseIsValid = true;\r\n            toReturn.state = ValidationResult.Ok;\r\n            this.handleSuccessfulValidation();\r\n            this.handleUnsuccessfulValidation();\r\n            return toReturn;\r\n        }\r\n\r\n        if (\r\n            !this.oidcSecurityValidation.validate_id_token_at_hash(\r\n                toReturn.access_token,\r\n                toReturn.decoded_id_token.at_hash,\r\n                this.configurationProvider.openIDConfiguration.response_type === 'code'\r\n            ) ||\r\n            !toReturn.access_token\r\n        ) {\r\n            this.loggerService.logWarning('authorizedCallback incorrect at_hash');\r\n            toReturn.state = ValidationResult.IncorrectAtHash;\r\n            this.handleUnsuccessfulValidation();\r\n            return toReturn;\r\n        }\r\n\r\n        toReturn.authResponseIsValid = true;\r\n        toReturn.state = ValidationResult.Ok;\r\n        this.handleSuccessfulValidation();\r\n        return toReturn;\r\n    }\r\n\r\n    private handleSuccessfulValidation() {\r\n        this.oidcSecurityCommon.authNonce = '';\r\n\r\n        if (this.configurationProvider.openIDConfiguration.auto_clean_state_after_authentication) {\r\n            this.oidcSecurityCommon.authStateControl = '';\r\n        }\r\n        this.loggerService.logDebug('AuthorizedCallback token(s) validated, continue');\r\n    }\r\n\r\n    private handleUnsuccessfulValidation() {\r\n        this.oidcSecurityCommon.authNonce = '';\r\n\r\n        if (this.configurationProvider.openIDConfiguration.auto_clean_state_after_authentication) {\r\n            this.oidcSecurityCommon.authStateControl = '';\r\n        }\r\n        this.loggerService.logDebug('AuthorizedCallback token(s) invalid');\r\n    }\r\n}\r\n","import { Injectable, NgZone } from '@angular/core';\r\nimport { from, Observable, Observer, Subject } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\nimport { ConfigurationProvider } from './auth-configuration.provider';\r\nimport { IFrameService } from './existing-iframe.service';\r\nimport { LoggerService } from './oidc.logger.service';\r\nimport { OidcSecurityCommon } from './oidc.security.common';\r\n\r\nconst IFRAME_FOR_CHECK_SESSION_IDENTIFIER = 'myiFrameForCheckSession';\r\n\r\n// http://openid.net/specs/openid-connect-session-1_0-ID4.html\r\n\r\n@Injectable()\r\nexport class OidcSecurityCheckSession {\r\n    private sessionIframe: any;\r\n    private iframeMessageEvent: any;\r\n    private scheduledHeartBeat: any;\r\n    private lastIFrameRefresh = 0;\r\n    private outstandingMessages = 0;\r\n    private heartBeatInterval = 3000;\r\n    private iframeRefreshInterval = 60000;\r\n    private checkSessionChanged = new Subject<any>();\r\n\r\n    public get onCheckSessionChanged(): Observable<any> {\r\n        return this.checkSessionChanged.asObservable();\r\n    }\r\n\r\n    constructor(\r\n        private oidcSecurityCommon: OidcSecurityCommon,\r\n        private loggerService: LoggerService,\r\n        private iFrameService: IFrameService,\r\n        private zone: NgZone,\r\n        private readonly configurationProvider: ConfigurationProvider\r\n    ) {}\r\n\r\n    private doesSessionExist(): boolean {\r\n        const existingIFrame = this.iFrameService.getExistingIFrame(IFRAME_FOR_CHECK_SESSION_IDENTIFIER);\r\n\r\n        if (!existingIFrame) {\r\n            return false;\r\n        }\r\n\r\n        this.sessionIframe = existingIFrame;\r\n        return true;\r\n    }\r\n\r\n    private init() {\r\n        if (this.lastIFrameRefresh + this.iframeRefreshInterval > Date.now()) {\r\n            return from([this]);\r\n        }\r\n\r\n        if (!this.doesSessionExist()) {\r\n            this.sessionIframe = this.iFrameService.addIFrameToWindowBody(IFRAME_FOR_CHECK_SESSION_IDENTIFIER);\r\n            this.iframeMessageEvent = this.messageHandler.bind(this);\r\n            window.addEventListener('message', this.iframeMessageEvent, false);\r\n        }\r\n\r\n        if (!this.configurationProvider.wellKnownEndpoints) {\r\n            this.loggerService.logWarning('init check session: authWellKnownEndpoints is undefined. Returning.');\r\n            return;\r\n        }\r\n\r\n        if (this.configurationProvider.wellKnownEndpoints.check_session_iframe) {\r\n            this.sessionIframe.contentWindow.location.replace(this.configurationProvider.wellKnownEndpoints.check_session_iframe);\r\n        } else {\r\n            this.loggerService.logWarning('init check session: authWellKnownEndpoints is undefined');\r\n        }\r\n\r\n        return Observable.create((observer: Observer<OidcSecurityCheckSession>) => {\r\n            this.sessionIframe.onload = () => {\r\n                this.lastIFrameRefresh = Date.now();\r\n                observer.next(this);\r\n                observer.complete();\r\n            };\r\n        });\r\n    }\r\n\r\n    startCheckingSession(clientId: string): void {\r\n        if (this.scheduledHeartBeat) {\r\n            return;\r\n        }\r\n\r\n        this.pollServerSession(clientId);\r\n    }\r\n\r\n    stopCheckingSession(): void {\r\n        if (!this.scheduledHeartBeat) {\r\n            return;\r\n        }\r\n\r\n        this.clearScheduledHeartBeat();\r\n    }\r\n\r\n    private pollServerSession(clientId: string) {\r\n        const pollServerSessionRecur = () => {\r\n            this.init()\r\n                .pipe(take(1))\r\n                .subscribe(() => {\r\n                    if (this.sessionIframe && clientId) {\r\n                        this.loggerService.logDebug(this.sessionIframe);\r\n                        const sessionState = this.oidcSecurityCommon.sessionState;\r\n                        if (sessionState) {\r\n                            this.outstandingMessages++;\r\n                            this.sessionIframe.contentWindow.postMessage(\r\n                                clientId + ' ' + sessionState,\r\n                                this.configurationProvider.openIDConfiguration.stsServer\r\n                            );\r\n                        } else {\r\n                            this.loggerService.logDebug('OidcSecurityCheckSession pollServerSession session_state is blank');\r\n                            this.checkSessionChanged.next();\r\n                        }\r\n                    } else {\r\n                        this.loggerService.logWarning('OidcSecurityCheckSession pollServerSession sessionIframe does not exist');\r\n                        this.loggerService.logDebug(clientId);\r\n                        this.loggerService.logDebug(this.sessionIframe);\r\n                        // this.init();\r\n                    }\r\n\r\n                    // after sending three messages with no response, fail.\r\n                    if (this.outstandingMessages > 3) {\r\n                        this.loggerService.logError(\r\n                            `OidcSecurityCheckSession not receiving check session response messages.\r\n                            Outstanding messages: ${this.outstandingMessages}. Server unreachable?`\r\n                        );\r\n                        this.checkSessionChanged.next();\r\n                    }\r\n\r\n                    this.scheduledHeartBeat = setTimeout(pollServerSessionRecur, this.heartBeatInterval);\r\n                });\r\n        };\r\n\r\n        this.outstandingMessages = 0;\r\n\r\n        this.zone.runOutsideAngular(() => {\r\n            this.scheduledHeartBeat = setTimeout(pollServerSessionRecur, this.heartBeatInterval);\r\n        });\r\n    }\r\n    private clearScheduledHeartBeat() {\r\n        clearTimeout(this.scheduledHeartBeat);\r\n        this.scheduledHeartBeat = null;\r\n    }\r\n\r\n    private messageHandler(e: any) {\r\n        this.outstandingMessages = 0;\r\n        if (\r\n            this.sessionIframe &&\r\n            e.origin === this.configurationProvider.openIDConfiguration.stsServer &&\r\n            e.source === this.sessionIframe.contentWindow\r\n        ) {\r\n            if (e.data === 'error') {\r\n                this.loggerService.logWarning('error from checksession messageHandler');\r\n            } else if (e.data === 'changed') {\r\n                this.checkSessionChanged.next();\r\n            } else {\r\n                this.loggerService.logDebug(e.data + ' from checksession messageHandler');\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, of, ReplaySubject } from 'rxjs';\r\nimport { catchError, switchMap } from 'rxjs/operators';\r\nimport { LoggerService } from './oidc.logger.service';\r\n\r\nexport interface ConfigResult {\r\n    authWellknownEndpoints: any;\r\n    customConfig: any;\r\n}\r\n\r\n@Injectable()\r\nexport class OidcConfigService {\r\n    private configurationLoadedInternal = new ReplaySubject<ConfigResult>(1);\r\n\r\n    public get onConfigurationLoaded(): Observable<ConfigResult> {\r\n        return this.configurationLoadedInternal.asObservable();\r\n    }\r\n\r\n    constructor(private readonly loggerService: LoggerService, private readonly httpClient: HttpClient) {}\r\n\r\n    load(configUrl: string): Promise<boolean> {\r\n        return this.httpClient\r\n            .get(configUrl)\r\n            .pipe(\r\n                switchMap(clientConfiguration => {\r\n                    return this.loadUsingConfiguration(clientConfiguration);\r\n                }),\r\n                catchError(error => {\r\n                    this.loggerService.logError(`OidcConfigService 'load' threw an error on calling ${configUrl}`, error);\r\n                    this.configurationLoadedInternal.next(undefined);\r\n                    return of(false);\r\n                })\r\n            )\r\n            .toPromise();\r\n    }\r\n\r\n    load_using_stsServer(stsServer: string): Promise<boolean> {\r\n        return this.loadUsingConfiguration({ stsServer }).toPromise();\r\n    }\r\n\r\n    load_using_custom_stsServer(url: string): Promise<boolean> {\r\n        return this.httpClient\r\n            .get(url)\r\n            .pipe(\r\n                switchMap(wellKnownEndpoints => {\r\n                    this.configurationLoadedInternal.next({\r\n                        authWellknownEndpoints: wellKnownEndpoints,\r\n                        customConfig: { stsServer: url },\r\n                    });\r\n                    return of(true);\r\n                }),\r\n                catchError(error => {\r\n                    this.loggerService.logError(`OidcConfigService 'load_using_custom_stsServer' threw an error on calling ${url}`, error);\r\n                    this.configurationLoadedInternal.next(undefined);\r\n                    return of(false);\r\n                })\r\n            )\r\n            .toPromise();\r\n    }\r\n\r\n    private loadUsingConfiguration(clientConfig: any): Observable<boolean> {\r\n        if (!clientConfig.stsServer) {\r\n            this.loggerService.logError(`Property 'stsServer' is not present of passed config ${JSON.stringify(clientConfig)}`, clientConfig);\r\n            throw new Error(`Property 'stsServer' is not present of passed config ${JSON.stringify(clientConfig)}`);\r\n        }\r\n\r\n        const url = `${clientConfig.stsServer}/.well-known/openid-configuration`;\r\n\r\n        return this.httpClient.get(url).pipe(\r\n            switchMap(wellKnownEndpoints => {\r\n                this.configurationLoadedInternal.next({\r\n                    authWellknownEndpoints: wellKnownEndpoints,\r\n                    customConfig: clientConfig,\r\n                });\r\n                return of(true);\r\n            }),\r\n            catchError(error => {\r\n                this.loggerService.logError(`OidcConfigService 'load_using_stsServer' threw an error on calling ${url}`, error);\r\n                this.configurationLoadedInternal.next(undefined);\r\n                return of(false);\r\n            })\r\n        );\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { IFrameService } from './existing-iframe.service';\r\nimport { LoggerService } from './oidc.logger.service';\r\n\r\nconst IFRAME_FOR_SILENT_RENEW_IDENTIFIER = 'myiFrameForSilentRenew';\r\n\r\n@Injectable()\r\nexport class OidcSecuritySilentRenew {\r\n    constructor(private loggerService: LoggerService, private iFrameService: IFrameService) {}\r\n\r\n    initRenew(): HTMLIFrameElement {\r\n        const existingIFrame = this.iFrameService.getExistingIFrame(IFRAME_FOR_SILENT_RENEW_IDENTIFIER);\r\n        if (!existingIFrame) {\r\n            return this.iFrameService.addIFrameToWindowBody(IFRAME_FOR_SILENT_RENEW_IDENTIFIER);\r\n        }\r\n        return existingIFrame;\r\n    }\r\n\r\n    startRenew(url: string): Observable<void> {\r\n        const sessionIframe = this.initRenew();\r\n        this.loggerService.logDebug('startRenew for URL:' + url);\r\n        return new Observable<void>(observer => {\r\n            const onLoadHandler = () => {\r\n                sessionIframe.removeEventListener('load', onLoadHandler);\r\n                observer.next(undefined);\r\n                observer.complete();\r\n            };\r\n            sessionIframe.addEventListener('load', onLoadHandler);\r\n            sessionIframe.src = url;\r\n            return () => {\r\n                sessionIframe.removeEventListener('load', onLoadHandler);\r\n            };\r\n        });\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { OidcDataService } from '../data-services/oidc-data.service';\r\nimport { ConfigurationProvider } from './auth-configuration.provider';\r\nimport { LoggerService } from './oidc.logger.service';\r\nimport { OidcSecurityCommon } from './oidc.security.common';\r\n\r\n@Injectable()\r\nexport class OidcSecurityUserService {\r\n    private userData: any = '';\r\n\r\n    constructor(\r\n        private oidcDataService: OidcDataService,\r\n        private oidcSecurityCommon: OidcSecurityCommon,\r\n        private loggerService: LoggerService,\r\n        private readonly configurationProvider: ConfigurationProvider\r\n    ) {}\r\n\r\n    initUserData() {\r\n        return this.getIdentityUserData().pipe(map((data: any) => (this.userData = data)));\r\n    }\r\n\r\n    getUserData(): any {\r\n        if (!this.userData) {\r\n            throw Error('UserData is not set!');\r\n        }\r\n\r\n        return this.userData;\r\n    }\r\n\r\n    setUserData(value: any): void {\r\n        this.userData = value;\r\n    }\r\n\r\n    private getIdentityUserData(): Observable<any> {\r\n        const token = this.oidcSecurityCommon.getAccessToken();\r\n\r\n        if (!this.configurationProvider.wellKnownEndpoints) {\r\n            this.loggerService.logWarning('init check session: authWellKnownEndpoints is undefined');\r\n\r\n            throw Error('authWellKnownEndpoints is undefined');\r\n        }\r\n\r\n        const canGetUserData = this.configurationProvider.wellKnownEndpoints && this.configurationProvider.wellKnownEndpoints.userinfo_endpoint;\r\n\r\n        if (!canGetUserData) {\r\n            this.loggerService.logError(\r\n                'init check session: authWellKnownEndpoints.userinfo_endpoint is undefined; set auto_userinfo = false in config'\r\n            );\r\n            throw Error('authWellKnownEndpoints.userinfo_endpoint is undefined');\r\n        }\r\n\r\n        return this.oidcDataService.getIdentityUserData(this.configurationProvider.wellKnownEndpoints.userinfo_endpoint || '', token);\r\n    }\r\n}\r\n","import { HttpParameterCodec } from '@angular/common/http';\r\n\r\nexport class UriEncoder implements HttpParameterCodec {\r\n    encodeKey(key: string): string {\r\n        return encodeURIComponent(key);\r\n    }\r\n\r\n    encodeValue(value: string): string {\r\n        return encodeURIComponent(value);\r\n    }\r\n\r\n    decodeKey(key: string): string {\r\n        return decodeURIComponent(key);\r\n    }\r\n\r\n    decodeValue(value: string): string {\r\n        return decodeURIComponent(value);\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class UrlParserService {\r\n    getUrlParameter(urlToCheck: any, name: any): string {\r\n        if (!urlToCheck) {\r\n            return '';\r\n        }\r\n\r\n        if (!name) {\r\n            return '';\r\n        }\r\n\r\n        name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\r\n        const regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\r\n        const results = regex.exec(urlToCheck);\r\n        return results === null ? '' : decodeURIComponent(results[1]);\r\n    }\r\n}\r\n","import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\r\nimport { Injectable, NgZone } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { BehaviorSubject, from, Observable, of, Subject, throwError, timer } from 'rxjs';\r\nimport { catchError, filter, map, race, shareReplay, switchMap, switchMapTo, take, tap } from 'rxjs/operators';\r\nimport { OidcDataService } from '../data-services/oidc-data.service';\r\nimport { OpenIdConfiguration } from '../models/auth.configuration';\r\nimport { AuthWellKnownEndpoints } from '../models/auth.well-known-endpoints';\r\nimport { AuthorizationResult } from '../models/authorization-result';\r\nimport { AuthorizationState } from '../models/authorization-state.enum';\r\nimport { JwtKeys } from '../models/jwtkeys';\r\nimport { ValidateStateResult } from '../models/validate-state-result.model';\r\nimport { ValidationResult } from '../models/validation-result.enum';\r\nimport { ConfigurationProvider } from './auth-configuration.provider';\r\nimport { StateValidationService } from './oidc-security-state-validation.service';\r\nimport { TokenHelperService } from './oidc-token-helper.service';\r\nimport { LoggerService } from './oidc.logger.service';\r\nimport { OidcSecurityCheckSession } from './oidc.security.check-session';\r\nimport { OidcSecurityCommon } from './oidc.security.common';\r\nimport { OidcSecuritySilentRenew } from './oidc.security.silent-renew';\r\nimport { OidcSecurityUserService } from './oidc.security.user-service';\r\nimport { OidcSecurityValidation } from './oidc.security.validation';\r\nimport { UriEncoder } from './uri-encoder';\r\nimport { UrlParserService } from './url-parser.service';\r\nimport { oneLine } from 'common-tags';\r\n\r\n// tslint:disable: variable-name\r\n@Injectable()\r\nexport class OidcSecurityService {\r\n    private _onModuleSetup = new Subject<boolean>();\r\n    private _onCheckSessionChanged = new Subject<boolean>();\r\n    private _onAuthorizationResult = new Subject<AuthorizationResult>();\r\n\r\n    public get onModuleSetup(): Observable<boolean> {\r\n        return this._onModuleSetup.asObservable();\r\n    }\r\n\r\n    public get onAuthorizationResult(): Observable<AuthorizationResult> {\r\n        return this._onAuthorizationResult.asObservable();\r\n    }\r\n\r\n    public get onCheckSessionChanged(): Observable<boolean> {\r\n        return this._onCheckSessionChanged.asObservable();\r\n    }\r\n\r\n    public get onConfigurationChange(): Observable<OpenIdConfiguration> {\r\n        return this.configurationProvider.onConfigurationChange;\r\n    }\r\n\r\n    checkSessionChanged = false;\r\n    moduleSetup = false;\r\n\r\n    private _isModuleSetup = new BehaviorSubject<boolean>(false);\r\n\r\n    private _isAuthorized = new BehaviorSubject<boolean>(false);\r\n    private _isSetupAndAuthorized: Observable<boolean>;\r\n\r\n    private _userData = new BehaviorSubject<any>('');\r\n    private authWellKnownEndpointsLoaded = false;\r\n    private runTokenValidationRunning = false;\r\n    private _scheduledHeartBeat: any;\r\n    private boundSilentRenewEvent: any;\r\n\r\n    constructor(\r\n        private oidcDataService: OidcDataService,\r\n        private stateValidationService: StateValidationService,\r\n        private router: Router,\r\n        private oidcSecurityCheckSession: OidcSecurityCheckSession,\r\n        private oidcSecuritySilentRenew: OidcSecuritySilentRenew,\r\n        private oidcSecurityUserService: OidcSecurityUserService,\r\n        private oidcSecurityCommon: OidcSecurityCommon,\r\n        private oidcSecurityValidation: OidcSecurityValidation,\r\n        private tokenHelperService: TokenHelperService,\r\n        private loggerService: LoggerService,\r\n        private zone: NgZone,\r\n        private readonly httpClient: HttpClient,\r\n        private readonly configurationProvider: ConfigurationProvider,\r\n        private readonly urlParserService: UrlParserService\r\n    ) {\r\n        this.onModuleSetup.pipe(take(1)).subscribe(() => {\r\n            this.moduleSetup = true;\r\n            this._isModuleSetup.next(true);\r\n        });\r\n\r\n        this._isSetupAndAuthorized = this._isModuleSetup.pipe(\r\n            filter((isModuleSetup: boolean) => isModuleSetup),\r\n            switchMap(() => {\r\n                if (!this.configurationProvider.openIDConfiguration.silent_renew) {\r\n                    this.loggerService.logDebug(`IsAuthorizedRace: Silent Renew Not Active. Emitting.`);\r\n                    return from([true]);\r\n                }\r\n\r\n                const race$ = this._isAuthorized.asObservable().pipe(\r\n                    filter((isAuthorized: boolean) => isAuthorized),\r\n                    take(1),\r\n                    tap(() => this.loggerService.logDebug('IsAuthorizedRace: Existing token is still authorized.')),\r\n                    // tslint:disable-next-line: deprecation\r\n                    race(\r\n                        this._onAuthorizationResult.pipe(\r\n                            take(1),\r\n                            tap(() => this.loggerService.logDebug('IsAuthorizedRace: Silent Renew Refresh Session Complete')),\r\n                            map(() => true)\r\n                        ),\r\n                        timer(this.configurationProvider.openIDConfiguration.isauthorizedrace_timeout_in_seconds * 1000).pipe(\r\n                            // backup, if nothing happens after X seconds stop waiting and emit (5s Default)\r\n                            tap(() => {\r\n                                this.resetAuthorizationData(false);\r\n                                this.oidcSecurityCommon.authNonce = '';\r\n                                this.loggerService.logWarning('IsAuthorizedRace: Timeout reached. Emitting.');\r\n                            }),\r\n                            map(() => true)\r\n                        )\r\n                    )\r\n                );\r\n\r\n                this.loggerService.logDebug('Silent Renew is active, check if token in storage is active');\r\n                if (this.oidcSecurityCommon.authNonce === '' || this.oidcSecurityCommon.authNonce === undefined) {\r\n                    // login not running, or a second silent renew, user must login first before this will work.\r\n                    this.loggerService.logDebug('Silent Renew or login not running, try to refresh the session');\r\n                    this.refreshSession().subscribe();\r\n                }\r\n\r\n                return race$;\r\n            }),\r\n            tap(() => this.loggerService.logDebug('IsAuthorizedRace: Completed')),\r\n            switchMapTo(this._isAuthorized.asObservable()),\r\n            tap((isAuthorized: boolean) => this.loggerService.logDebug(`getIsAuthorized: ${isAuthorized}`)),\r\n            shareReplay(1)\r\n        );\r\n\r\n        this._isSetupAndAuthorized\r\n            .pipe(filter(() => this.configurationProvider.openIDConfiguration.start_checksession))\r\n            .subscribe(isSetupAndAuthorized => {\r\n                if (isSetupAndAuthorized) {\r\n                    this.oidcSecurityCheckSession.startCheckingSession(this.configurationProvider.openIDConfiguration.client_id);\r\n                } else {\r\n                    this.oidcSecurityCheckSession.stopCheckingSession();\r\n                }\r\n            });\r\n    }\r\n\r\n    setupModule(openIdConfiguration: OpenIdConfiguration, authWellKnownEndpoints: AuthWellKnownEndpoints): void {\r\n        this.configurationProvider.setup(openIdConfiguration, authWellKnownEndpoints);\r\n\r\n        this.oidcSecurityCheckSession.onCheckSessionChanged.subscribe(() => {\r\n            this.loggerService.logDebug('onCheckSessionChanged');\r\n            this.checkSessionChanged = true;\r\n            this._onCheckSessionChanged.next(this.checkSessionChanged);\r\n        });\r\n\r\n        const userData = this.oidcSecurityCommon.userData;\r\n        if (userData) {\r\n            this.setUserData(userData);\r\n        }\r\n\r\n        const isAuthorized = this.oidcSecurityCommon.isAuthorized;\r\n        if (isAuthorized) {\r\n            this.loggerService.logDebug('IsAuthorized setup module');\r\n            this.loggerService.logDebug(this.oidcSecurityCommon.idToken);\r\n            if (\r\n                this.oidcSecurityValidation.isTokenExpired(\r\n                    this.oidcSecurityCommon.idToken || this.oidcSecurityCommon.accessToken,\r\n                    this.configurationProvider.openIDConfiguration.silent_renew_offset_in_seconds\r\n                )\r\n            ) {\r\n                this.loggerService.logDebug('IsAuthorized setup module; id_token isTokenExpired');\r\n            } else {\r\n                this.loggerService.logDebug('IsAuthorized setup module; id_token is valid');\r\n                this.setIsAuthorized(isAuthorized);\r\n            }\r\n            this.runTokenValidation();\r\n        }\r\n\r\n        this.loggerService.logDebug('STS server: ' + this.configurationProvider.openIDConfiguration.stsServer);\r\n\r\n        this._onModuleSetup.next();\r\n\r\n        if (this.configurationProvider.openIDConfiguration.silent_renew) {\r\n            this.oidcSecuritySilentRenew.initRenew();\r\n\r\n            // Support authorization via DOM events.\r\n            // Deregister if OidcSecurityService.setupModule is called again by any instance.\r\n            //      We only ever want the latest setup service to be reacting to this event.\r\n            this.boundSilentRenewEvent = this.silentRenewEventHandler.bind(this);\r\n\r\n            const instanceId = Math.random();\r\n\r\n            const boundSilentRenewInitEvent: any = ((e: CustomEvent) => {\r\n                if (e.detail !== instanceId) {\r\n                    window.removeEventListener('oidc-silent-renew-message', this.boundSilentRenewEvent);\r\n                    window.removeEventListener('oidc-silent-renew-init', boundSilentRenewInitEvent);\r\n                }\r\n            }).bind(this);\r\n\r\n            window.addEventListener('oidc-silent-renew-init', boundSilentRenewInitEvent, false);\r\n            window.addEventListener('oidc-silent-renew-message', this.boundSilentRenewEvent, false);\r\n\r\n            window.dispatchEvent(\r\n                new CustomEvent('oidc-silent-renew-init', {\r\n                    detail: instanceId,\r\n                })\r\n            );\r\n        }\r\n    }\r\n\r\n    getUserData<T = any>(): Observable<T> {\r\n        return this._userData.asObservable();\r\n    }\r\n\r\n    getIsModuleSetup(): Observable<boolean> {\r\n        return this._isModuleSetup.asObservable();\r\n    }\r\n\r\n    getIsAuthorized(): Observable<boolean> {\r\n        return this._isSetupAndAuthorized;\r\n    }\r\n\r\n    getToken(): string {\r\n        if (!this._isAuthorized.getValue()) {\r\n            return '';\r\n        }\r\n\r\n        const token = this.oidcSecurityCommon.getAccessToken();\r\n        return decodeURIComponent(token);\r\n    }\r\n\r\n    getIdToken(): string {\r\n        if (!this._isAuthorized.getValue()) {\r\n            return '';\r\n        }\r\n\r\n        const token = this.oidcSecurityCommon.getIdToken();\r\n        return decodeURIComponent(token);\r\n    }\r\n\r\n    getRefreshToken(): string {\r\n        if (!this._isAuthorized.getValue()) {\r\n            return '';\r\n        }\r\n\r\n        const token = this.oidcSecurityCommon.getRefreshToken();\r\n        return decodeURIComponent(token);\r\n    }\r\n\r\n    getPayloadFromIdToken(encode = false): any {\r\n        const token = this.getIdToken();\r\n        return this.tokenHelperService.getPayloadFromToken(token, encode);\r\n    }\r\n\r\n    setState(state: string): void {\r\n        this.oidcSecurityCommon.authStateControl = state;\r\n    }\r\n\r\n    getState(): string {\r\n        return this.oidcSecurityCommon.authStateControl;\r\n    }\r\n\r\n    setCustomRequestParameters(params: { [key: string]: string | number | boolean }) {\r\n        this.oidcSecurityCommon.customRequestParams = params;\r\n    }\r\n\r\n    // Code Flow with PCKE or Implicit Flow\r\n    authorize(urlHandler?: (url: string) => any) {\r\n        if (this.configurationProvider.wellKnownEndpoints) {\r\n            this.authWellKnownEndpointsLoaded = true;\r\n        }\r\n\r\n        if (!this.authWellKnownEndpointsLoaded) {\r\n            this.loggerService.logError('Well known endpoints must be loaded before user can login!');\r\n            return;\r\n        }\r\n\r\n        if (!this.oidcSecurityValidation.config_validate_response_type(this.configurationProvider.openIDConfiguration.response_type)) {\r\n            // invalid response_type\r\n            return;\r\n        }\r\n\r\n        this.resetAuthorizationData(false);\r\n\r\n        this.loggerService.logDebug('BEGIN Authorize Code Flow, no auth data');\r\n\r\n        let state = this.oidcSecurityCommon.authStateControl;\r\n        if (!state) {\r\n            state = Date.now() + '' + Math.random() + Math.random();\r\n            this.oidcSecurityCommon.authStateControl = state;\r\n        }\r\n\r\n        const nonce = 'N' + Math.random() + '' + Date.now();\r\n        this.oidcSecurityCommon.authNonce = nonce;\r\n        this.loggerService.logDebug('AuthorizedController created. local state: ' + this.oidcSecurityCommon.authStateControl);\r\n\r\n        let url = '';\r\n        // Code Flow\r\n        if (this.configurationProvider.openIDConfiguration.response_type === 'code') {\r\n            // code_challenge with \"S256\"\r\n            const code_verifier = 'C' + Math.random() + '' + Date.now() + '' + Date.now() + Math.random();\r\n            const code_challenge = this.oidcSecurityValidation.generate_code_verifier(code_verifier);\r\n\r\n            this.oidcSecurityCommon.code_verifier = code_verifier;\r\n\r\n            if (this.configurationProvider.wellKnownEndpoints) {\r\n                url = this.createAuthorizeUrl(\r\n                    true,\r\n                    code_challenge,\r\n                    this.configurationProvider.openIDConfiguration.redirect_url,\r\n                    nonce,\r\n                    state,\r\n                    this.configurationProvider.wellKnownEndpoints.authorization_endpoint || ''\r\n                );\r\n            } else {\r\n                this.loggerService.logError('authWellKnownEndpoints is undefined');\r\n            }\r\n        } else {\r\n            // Implicit Flow\r\n\r\n            if (this.configurationProvider.wellKnownEndpoints) {\r\n                url = this.createAuthorizeUrl(\r\n                    false,\r\n                    '',\r\n                    this.configurationProvider.openIDConfiguration.redirect_url,\r\n                    nonce,\r\n                    state,\r\n                    this.configurationProvider.wellKnownEndpoints.authorization_endpoint || ''\r\n                );\r\n            } else {\r\n                this.loggerService.logError('authWellKnownEndpoints is undefined');\r\n            }\r\n        }\r\n\r\n        if (urlHandler) {\r\n            urlHandler(url);\r\n        } else {\r\n            this.redirectTo(url);\r\n        }\r\n    }\r\n\r\n    // Code Flow\r\n    authorizedCallbackWithCode(urlToCheck: string) {\r\n        this.authorizedCallbackWithCode$(urlToCheck).subscribe();\r\n    }\r\n    authorizedCallbackWithCode$(urlToCheck: string): Observable<void> {\r\n        const code = this.urlParserService.getUrlParameter(urlToCheck, 'code');\r\n        const state = this.urlParserService.getUrlParameter(urlToCheck, 'state');\r\n        const sessionState = this.urlParserService.getUrlParameter(urlToCheck, 'session_state') || null;\r\n\r\n        if (!state) {\r\n            this.loggerService.logDebug('no state in url');\r\n            return of();\r\n        }\r\n        if (!code) {\r\n            this.loggerService.logDebug('no code in url');\r\n            return of();\r\n        }\r\n        this.loggerService.logDebug('running validation for callback' + urlToCheck);\r\n        return this.requestTokensWithCode$(code, state, sessionState);\r\n    }\r\n\r\n    // Code Flow\r\n    requestTokensWithCode(code: string, state: string, sessionState: string | null): void {\r\n        this.requestTokensWithCode$(code, state, sessionState).subscribe();\r\n    }\r\n\r\n    requestTokensWithCode$(code: string, state: string, sessionState: string | null): Observable<void> {\r\n        return this._isModuleSetup.pipe(\r\n            filter(isModuleSetup => !!isModuleSetup),\r\n            take(1),\r\n            switchMap(() => {\r\n                return this.requestTokensWithCodeProcedure$(code, state, sessionState);\r\n            })\r\n        );\r\n    }\r\n\r\n    // Refresh Token\r\n    refreshTokensWithCodeProcedure(code: string, state: string): Observable<any> {\r\n        let tokenRequestUrl = '';\r\n        if (this.configurationProvider.wellKnownEndpoints && this.configurationProvider.wellKnownEndpoints.token_endpoint) {\r\n            tokenRequestUrl = `${this.configurationProvider.wellKnownEndpoints.token_endpoint}`;\r\n        }\r\n\r\n        let headers: HttpHeaders = new HttpHeaders();\r\n        headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\r\n\r\n        const data = `grant_type=refresh_token&client_id=${this.configurationProvider.openIDConfiguration.client_id}&refresh_token=${code}`;\r\n\r\n        return this.httpClient.post(tokenRequestUrl, data, { headers }).pipe(\r\n            map(response => {\r\n                this.loggerService.logDebug('token refresh response: ' + JSON.stringify(response));\r\n                let obj: any = new Object();\r\n                obj = response;\r\n                obj.state = state;\r\n\r\n                this.authorizedCodeFlowCallbackProcedure(obj);\r\n            }),\r\n            catchError(error => {\r\n                this.loggerService.logError(error);\r\n                this.loggerService.logError(`OidcService code request ${this.configurationProvider.openIDConfiguration.stsServer}`);\r\n                return of(false);\r\n            })\r\n        );\r\n    }\r\n\r\n    requestTokensWithCodeProcedure(code: string, state: string, session_state: string | null): void {\r\n        this.requestTokensWithCodeProcedure$(code, state, session_state).subscribe();\r\n    }\r\n\r\n    // Code Flow with PCKE\r\n    requestTokensWithCodeProcedure$(code: string, state: string, session_state: string | null): Observable<void> {\r\n        let tokenRequestUrl = '';\r\n        if (this.configurationProvider.wellKnownEndpoints && this.configurationProvider.wellKnownEndpoints.token_endpoint) {\r\n            tokenRequestUrl = `${this.configurationProvider.wellKnownEndpoints.token_endpoint}`;\r\n        }\r\n\r\n        if (!this.oidcSecurityValidation.validateStateFromHashCallback(state, this.oidcSecurityCommon.authStateControl)) {\r\n            this.loggerService.logWarning('authorizedCallback incorrect state');\r\n            // ValidationResult.StatesDoNotMatch;\r\n            return throwError(new Error('incorrect state'));\r\n        }\r\n\r\n        let headers: HttpHeaders = new HttpHeaders();\r\n        headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\r\n\r\n        let data = oneLine`grant_type=authorization_code&client_id=${this.configurationProvider.openIDConfiguration.client_id}\r\n            &code_verifier=${this.oidcSecurityCommon.code_verifier}\r\n            &code=${code}&redirect_uri=${this.configurationProvider.openIDConfiguration.redirect_url}`;\r\n\r\n        if (this.oidcSecurityCommon.silentRenewRunning === 'running') {\r\n            data = oneLine`grant_type=authorization_code&client_id=${this.configurationProvider.openIDConfiguration.client_id}\r\n                &code_verifier=${this.oidcSecurityCommon.code_verifier}\r\n                &code=${code}\r\n                &redirect_uri=${this.configurationProvider.openIDConfiguration.silent_renew_url}`;\r\n        }\r\n\r\n        return this.httpClient.post(tokenRequestUrl, data, { headers }).pipe(\r\n            map(response => {\r\n                let obj: any = new Object();\r\n                obj = response;\r\n                obj.state = state;\r\n                obj.session_state = session_state;\r\n\r\n                this.authorizedCodeFlowCallbackProcedure(obj);\r\n\r\n                return undefined;\r\n            }),\r\n            catchError(error => {\r\n                this.loggerService.logError(error);\r\n                this.loggerService.logError(`OidcService code request ${this.configurationProvider.openIDConfiguration.stsServer}`);\r\n                return throwError(error);\r\n            })\r\n        );\r\n    }\r\n\r\n    // Code Flow\r\n    private authorizedCodeFlowCallbackProcedure(result: any) {\r\n        const silentRenew = this.oidcSecurityCommon.silentRenewRunning;\r\n        const isRenewProcess = silentRenew === 'running';\r\n\r\n        this.loggerService.logDebug('BEGIN authorized Code Flow Callback, no auth data');\r\n        this.resetAuthorizationData(isRenewProcess);\r\n        this.authorizedCallbackProcedure(result, isRenewProcess);\r\n    }\r\n\r\n    // Implicit Flow\r\n    private authorizedImplicitFlowCallbackProcedure(hash?: string) {\r\n        const silentRenew = this.oidcSecurityCommon.silentRenewRunning;\r\n        const isRenewProcess = silentRenew === 'running';\r\n\r\n        this.loggerService.logDebug('BEGIN authorizedCallback, no auth data');\r\n        this.resetAuthorizationData(isRenewProcess);\r\n\r\n        hash = hash || window.location.hash.substr(1);\r\n\r\n        const result: any = hash.split('&').reduce((resultData: any, item: string) => {\r\n            const parts = item.split('=');\r\n            resultData[parts.shift() as string] = parts.join('=');\r\n            return resultData;\r\n        }, {});\r\n\r\n        this.authorizedCallbackProcedure(result, isRenewProcess);\r\n    }\r\n\r\n    // Implicit Flow\r\n    authorizedImplicitFlowCallback(hash?: string) {\r\n        this._isModuleSetup\r\n            .pipe(\r\n                filter((isModuleSetup: boolean) => isModuleSetup),\r\n                take(1)\r\n            )\r\n            .subscribe(() => {\r\n                this.authorizedImplicitFlowCallbackProcedure(hash);\r\n            });\r\n    }\r\n\r\n    private redirectTo(url: string) {\r\n        window.location.href = url;\r\n    }\r\n\r\n    // Implicit Flow\r\n    private authorizedCallbackProcedure(result: any, isRenewProcess: boolean) {\r\n        this.oidcSecurityCommon.authResult = result;\r\n\r\n        if (!this.configurationProvider.openIDConfiguration.history_cleanup_off && !isRenewProcess) {\r\n            // reset the history to remove the tokens\r\n            window.history.replaceState({}, window.document.title, window.location.origin + window.location.pathname);\r\n        } else {\r\n            this.loggerService.logDebug('history clean up inactive');\r\n        }\r\n\r\n        if (result.error) {\r\n            if (isRenewProcess) {\r\n                this.loggerService.logDebug(result);\r\n            } else {\r\n                this.loggerService.logWarning(result);\r\n            }\r\n\r\n            if ((result.error as string) === 'login_required') {\r\n                this._onAuthorizationResult.next(\r\n                    new AuthorizationResult(AuthorizationState.unauthorized, ValidationResult.LoginRequired, isRenewProcess)\r\n                );\r\n            } else {\r\n                this._onAuthorizationResult.next(\r\n                    new AuthorizationResult(AuthorizationState.unauthorized, ValidationResult.SecureTokenServerError, isRenewProcess)\r\n                );\r\n            }\r\n\r\n            this.resetAuthorizationData(false);\r\n            this.oidcSecurityCommon.authNonce = '';\r\n\r\n            if (!this.configurationProvider.openIDConfiguration.trigger_authorization_result_event && !isRenewProcess) {\r\n                this.router.navigate([this.configurationProvider.openIDConfiguration.unauthorized_route]);\r\n            }\r\n        } else {\r\n            this.loggerService.logDebug(result);\r\n\r\n            this.loggerService.logDebug('authorizedCallback created, begin token validation');\r\n\r\n            this.getSigningKeys().subscribe(\r\n                jwtKeys => {\r\n                    const validationResult = this.getValidatedStateResult(result, jwtKeys);\r\n\r\n                    if (validationResult.authResponseIsValid) {\r\n                        this.setAuthorizationData(validationResult.access_token, validationResult.id_token);\r\n                        this.oidcSecurityCommon.silentRenewRunning = '';\r\n\r\n                        if (this.configurationProvider.openIDConfiguration.auto_userinfo) {\r\n                            this.getUserinfo(isRenewProcess, result, validationResult.id_token, validationResult.decoded_id_token).subscribe(\r\n                                response => {\r\n                                    if (response) {\r\n                                        this._onAuthorizationResult.next(\r\n                                            new AuthorizationResult(AuthorizationState.authorized, validationResult.state, isRenewProcess)\r\n                                        );\r\n                                        if (!this.configurationProvider.openIDConfiguration.trigger_authorization_result_event && !isRenewProcess) {\r\n                                            this.router.navigate([this.configurationProvider.openIDConfiguration.post_login_route]);\r\n                                        }\r\n                                    } else {\r\n                                        this._onAuthorizationResult.next(\r\n                                            new AuthorizationResult(AuthorizationState.unauthorized, validationResult.state, isRenewProcess)\r\n                                        );\r\n                                        if (!this.configurationProvider.openIDConfiguration.trigger_authorization_result_event && !isRenewProcess) {\r\n                                            this.router.navigate([this.configurationProvider.openIDConfiguration.unauthorized_route]);\r\n                                        }\r\n                                    }\r\n                                },\r\n                                err => {\r\n                                    /* Something went wrong while getting signing key */\r\n                                    this.loggerService.logWarning('Failed to retreive user info with error: ' + JSON.stringify(err));\r\n                                }\r\n                            );\r\n                        } else {\r\n                            if (!isRenewProcess) {\r\n                                // userData is set to the id_token decoded, auto get user data set to false\r\n                                this.oidcSecurityUserService.setUserData(validationResult.decoded_id_token);\r\n                                this.setUserData(this.oidcSecurityUserService.getUserData());\r\n                            }\r\n\r\n                            this.runTokenValidation();\r\n\r\n                            this._onAuthorizationResult.next(\r\n                                new AuthorizationResult(AuthorizationState.authorized, validationResult.state, isRenewProcess)\r\n                            );\r\n                            if (!this.configurationProvider.openIDConfiguration.trigger_authorization_result_event && !isRenewProcess) {\r\n                                this.router.navigate([this.configurationProvider.openIDConfiguration.post_login_route]);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        // something went wrong\r\n                        this.loggerService.logWarning('authorizedCallback, token(s) validation failed, resetting');\r\n                        this.loggerService.logWarning(window.location.hash);\r\n                        this.resetAuthorizationData(false);\r\n                        this.oidcSecurityCommon.silentRenewRunning = '';\r\n\r\n                        this._onAuthorizationResult.next(\r\n                            new AuthorizationResult(AuthorizationState.unauthorized, validationResult.state, isRenewProcess)\r\n                        );\r\n                        if (!this.configurationProvider.openIDConfiguration.trigger_authorization_result_event && !isRenewProcess) {\r\n                            this.router.navigate([this.configurationProvider.openIDConfiguration.unauthorized_route]);\r\n                        }\r\n                    }\r\n                },\r\n                err => {\r\n                    /* Something went wrong while getting signing key */\r\n                    this.loggerService.logWarning('Failed to retreive siging key with error: ' + JSON.stringify(err));\r\n                    this.oidcSecurityCommon.silentRenewRunning = '';\r\n                }\r\n            );\r\n        }\r\n    }\r\n\r\n    getUserinfo(isRenewProcess = false, result?: any, id_token?: any, decoded_id_token?: any): Observable<boolean> {\r\n        result = result ? result : this.oidcSecurityCommon.authResult;\r\n        id_token = id_token ? id_token : this.oidcSecurityCommon.idToken;\r\n        decoded_id_token = decoded_id_token ? decoded_id_token : this.tokenHelperService.getPayloadFromToken(id_token, false);\r\n\r\n        return new Observable<boolean>(observer => {\r\n            // flow id_token token\r\n            if (\r\n                this.configurationProvider.openIDConfiguration.response_type === 'id_token token' ||\r\n                this.configurationProvider.openIDConfiguration.response_type === 'code'\r\n            ) {\r\n                if (isRenewProcess && this._userData.value) {\r\n                    this.oidcSecurityCommon.sessionState = result.session_state;\r\n                    observer.next(true);\r\n                    observer.complete();\r\n                } else {\r\n                    this.oidcSecurityUserService.initUserData().subscribe(() => {\r\n                        this.loggerService.logDebug('authorizedCallback (id_token token || code) flow');\r\n\r\n                        const userData = this.oidcSecurityUserService.getUserData();\r\n\r\n                        if (this.oidcSecurityValidation.validate_userdata_sub_id_token(decoded_id_token.sub, userData.sub)) {\r\n                            this.setUserData(userData);\r\n                            this.loggerService.logDebug(this.oidcSecurityCommon.accessToken);\r\n                            this.loggerService.logDebug(this.oidcSecurityUserService.getUserData());\r\n\r\n                            this.oidcSecurityCommon.sessionState = result.session_state;\r\n\r\n                            this.runTokenValidation();\r\n                            observer.next(true);\r\n                        } else {\r\n                            // something went wrong, userdata sub does not match that from id_token\r\n                            this.loggerService.logWarning('authorizedCallback, User data sub does not match sub in id_token');\r\n                            this.loggerService.logDebug('authorizedCallback, token(s) validation failed, resetting');\r\n                            this.resetAuthorizationData(false);\r\n                            observer.next(false);\r\n                        }\r\n                        observer.complete();\r\n                    });\r\n                }\r\n            } else {\r\n                // flow id_token\r\n                this.loggerService.logDebug('authorizedCallback id_token flow');\r\n                this.loggerService.logDebug(this.oidcSecurityCommon.accessToken);\r\n\r\n                // userData is set to the id_token decoded. No access_token.\r\n                this.oidcSecurityUserService.setUserData(decoded_id_token);\r\n                this.setUserData(this.oidcSecurityUserService.getUserData());\r\n\r\n                this.oidcSecurityCommon.sessionState = result.session_state;\r\n\r\n                this.runTokenValidation();\r\n\r\n                observer.next(true);\r\n                observer.complete();\r\n            }\r\n        });\r\n    }\r\n\r\n    logoff(urlHandler?: (url: string) => any) {\r\n        // /connect/endsession?id_token_hint=...&post_logout_redirect_uri=https://myapp.com\r\n        this.loggerService.logDebug('BEGIN Authorize, no auth data');\r\n\r\n        if (this.configurationProvider.wellKnownEndpoints) {\r\n            if (this.configurationProvider.wellKnownEndpoints.end_session_endpoint) {\r\n                const end_session_endpoint = this.configurationProvider.wellKnownEndpoints.end_session_endpoint;\r\n                const id_token_hint = this.oidcSecurityCommon.idToken;\r\n                const url = this.createEndSessionUrl(end_session_endpoint, id_token_hint);\r\n\r\n                this.resetAuthorizationData(false);\r\n\r\n                if (this.configurationProvider.openIDConfiguration.start_checksession && this.checkSessionChanged) {\r\n                    this.loggerService.logDebug('only local login cleaned up, server session has changed');\r\n                } else if (urlHandler) {\r\n                    urlHandler(url);\r\n                } else {\r\n                    this.redirectTo(url);\r\n                }\r\n            } else {\r\n                this.resetAuthorizationData(false);\r\n                this.loggerService.logDebug('only local login cleaned up, no end_session_endpoint');\r\n            }\r\n        } else {\r\n            this.loggerService.logWarning('authWellKnownEndpoints is undefined');\r\n        }\r\n    }\r\n\r\n    refreshSession(): Observable<boolean> {\r\n        if (!this.configurationProvider.openIDConfiguration.silent_renew) {\r\n            return of(false);\r\n        }\r\n\r\n        this.loggerService.logDebug('BEGIN refresh session Authorize');\r\n        this.oidcSecurityCommon.silentRenewRunning = 'running';\r\n\r\n        let state = this.oidcSecurityCommon.authStateControl;\r\n        if (state === '' || state === null) {\r\n            state = Date.now() + '' + Math.random() + Math.random();\r\n            this.oidcSecurityCommon.authStateControl = state;\r\n        }\r\n\r\n        const nonce = 'N' + Math.random() + '' + Date.now();\r\n        this.oidcSecurityCommon.authNonce = nonce;\r\n        this.loggerService.logDebug('RefreshSession created. adding myautostate: ' + this.oidcSecurityCommon.authStateControl);\r\n\r\n        let url = '';\r\n\r\n        // Code Flow\r\n        if (this.configurationProvider.openIDConfiguration.response_type === 'code') {\r\n            if (this.configurationProvider.openIDConfiguration.use_refresh_token) {\r\n                // try using refresh token\r\n                const refresh_token = this.oidcSecurityCommon.getRefreshToken();\r\n                if (refresh_token) {\r\n                    this.loggerService.logDebug('found refresh code, obtaining new credentials with refresh code');\r\n                    // Nonce is not used with refresh tokens; but Keycloak may send it anyway\r\n                    this.oidcSecurityCommon.authNonce = OidcSecurityValidation.RefreshTokenNoncePlaceholder;\r\n                    return this.refreshTokensWithCodeProcedure(refresh_token, state);\r\n                } else {\r\n                    this.loggerService.logDebug('no refresh token found, using silent renew');\r\n                }\r\n            }\r\n            // code_challenge with \"S256\"\r\n            const code_verifier = 'C' + Math.random() + '' + Date.now() + '' + Date.now() + Math.random();\r\n            const code_challenge = this.oidcSecurityValidation.generate_code_verifier(code_verifier);\r\n\r\n            this.oidcSecurityCommon.code_verifier = code_verifier;\r\n\r\n            if (this.configurationProvider.wellKnownEndpoints) {\r\n                url = this.createAuthorizeUrl(\r\n                    true,\r\n                    code_challenge,\r\n                    this.configurationProvider.openIDConfiguration.silent_renew_url,\r\n                    nonce,\r\n                    state,\r\n                    this.configurationProvider.wellKnownEndpoints.authorization_endpoint || '',\r\n                    'none'\r\n                );\r\n            } else {\r\n                this.loggerService.logWarning('authWellKnownEndpoints is undefined');\r\n            }\r\n        } else {\r\n            if (this.configurationProvider.wellKnownEndpoints) {\r\n                url = this.createAuthorizeUrl(\r\n                    false,\r\n                    '',\r\n                    this.configurationProvider.openIDConfiguration.silent_renew_url,\r\n                    nonce,\r\n                    state,\r\n                    this.configurationProvider.wellKnownEndpoints.authorization_endpoint || '',\r\n                    'none'\r\n                );\r\n            } else {\r\n                this.loggerService.logWarning('authWellKnownEndpoints is undefined');\r\n            }\r\n        }\r\n\r\n        return this.oidcSecuritySilentRenew.startRenew(url).pipe(map(() => true));\r\n    }\r\n\r\n    handleError(error: any) {\r\n        const silentRenew = this.oidcSecurityCommon.silentRenewRunning;\r\n        const isRenewProcess = silentRenew === 'running';\r\n        this.loggerService.logError(error);\r\n        if (error.status === 403 || error.status === '403') {\r\n            if (this.configurationProvider.openIDConfiguration.trigger_authorization_result_event) {\r\n                this._onAuthorizationResult.next(new AuthorizationResult(AuthorizationState.unauthorized, ValidationResult.NotSet, isRenewProcess));\r\n            } else {\r\n                this.router.navigate([this.configurationProvider.openIDConfiguration.forbidden_route]);\r\n            }\r\n        } else if (error.status === 401 || error.status === '401') {\r\n            const silentRenewRunning = this.oidcSecurityCommon.silentRenewRunning;\r\n\r\n            this.resetAuthorizationData(!!silentRenewRunning);\r\n\r\n            if (this.configurationProvider.openIDConfiguration.trigger_authorization_result_event) {\r\n                this._onAuthorizationResult.next(new AuthorizationResult(AuthorizationState.unauthorized, ValidationResult.NotSet, isRenewProcess));\r\n            } else {\r\n                this.router.navigate([this.configurationProvider.openIDConfiguration.unauthorized_route]);\r\n            }\r\n        }\r\n    }\r\n\r\n    startCheckingSilentRenew(): void {\r\n        this.runTokenValidation();\r\n    }\r\n\r\n    stopCheckingSilentRenew(): void {\r\n        if (this._scheduledHeartBeat) {\r\n            clearTimeout(this._scheduledHeartBeat);\r\n            this._scheduledHeartBeat = null;\r\n            this.runTokenValidationRunning = false;\r\n        }\r\n    }\r\n\r\n    resetAuthorizationData(isRenewProcess: boolean): void {\r\n        if (!isRenewProcess) {\r\n            if (this.configurationProvider.openIDConfiguration.auto_userinfo) {\r\n                // Clear user data. Fixes #97.\r\n                this.setUserData('');\r\n            }\r\n\r\n            this.oidcSecurityCommon.resetStorageData(isRenewProcess);\r\n            this.checkSessionChanged = false;\r\n            this.setIsAuthorized(false);\r\n        }\r\n    }\r\n\r\n    getEndSessionUrl(): string | undefined {\r\n        if (this.configurationProvider.wellKnownEndpoints) {\r\n            if (this.configurationProvider.wellKnownEndpoints.end_session_endpoint) {\r\n                const end_session_endpoint = this.configurationProvider.wellKnownEndpoints.end_session_endpoint;\r\n                const id_token_hint = this.oidcSecurityCommon.idToken;\r\n                return this.createEndSessionUrl(end_session_endpoint, id_token_hint);\r\n            }\r\n        }\r\n    }\r\n\r\n    private getValidatedStateResult(result: any, jwtKeys: JwtKeys): ValidateStateResult {\r\n        if (result.error) {\r\n            return new ValidateStateResult('', '', false, {});\r\n        }\r\n\r\n        return this.stateValidationService.validateState(result, jwtKeys);\r\n    }\r\n\r\n    private setUserData(userData: any): void {\r\n        this.oidcSecurityCommon.userData = userData;\r\n        this._userData.next(userData);\r\n    }\r\n\r\n    private setIsAuthorized(isAuthorized: boolean): void {\r\n        this._isAuthorized.next(isAuthorized);\r\n    }\r\n\r\n    private setAuthorizationData(access_token: any, id_token: any) {\r\n        if (this.oidcSecurityCommon.accessToken !== '') {\r\n            this.oidcSecurityCommon.accessToken = '';\r\n        }\r\n\r\n        this.loggerService.logDebug(access_token);\r\n        this.loggerService.logDebug(id_token);\r\n        this.loggerService.logDebug('storing to storage, getting the roles');\r\n        this.oidcSecurityCommon.accessToken = access_token;\r\n        this.oidcSecurityCommon.idToken = id_token;\r\n        this.setIsAuthorized(true);\r\n        this.oidcSecurityCommon.isAuthorized = true;\r\n    }\r\n\r\n    private createAuthorizeUrl(\r\n        isCodeFlow: boolean,\r\n        code_challenge: string,\r\n        redirect_url: string,\r\n        nonce: string,\r\n        state: string,\r\n        authorization_endpoint: string,\r\n        prompt?: string\r\n    ): string {\r\n        const urlParts = authorization_endpoint.split('?');\r\n        const authorizationUrl = urlParts[0];\r\n        let params = new HttpParams({\r\n            fromString: urlParts[1],\r\n            encoder: new UriEncoder(),\r\n        });\r\n        params = params.set('client_id', this.configurationProvider.openIDConfiguration.client_id);\r\n        params = params.append('redirect_uri', redirect_url);\r\n        params = params.append('response_type', this.configurationProvider.openIDConfiguration.response_type);\r\n        params = params.append('scope', this.configurationProvider.openIDConfiguration.scope);\r\n        params = params.append('nonce', nonce);\r\n        params = params.append('state', state);\r\n\r\n        if (isCodeFlow) {\r\n            params = params.append('code_challenge', code_challenge);\r\n            params = params.append('code_challenge_method', 'S256');\r\n        }\r\n\r\n        if (prompt) {\r\n            params = params.append('prompt', prompt);\r\n        }\r\n\r\n        if (this.configurationProvider.openIDConfiguration.hd_param) {\r\n            params = params.append('hd', this.configurationProvider.openIDConfiguration.hd_param);\r\n        }\r\n\r\n        const customParams = Object.assign({}, this.oidcSecurityCommon.customRequestParams);\r\n\r\n        Object.keys(customParams).forEach(key => {\r\n            params = params.append(key, customParams[key].toString());\r\n        });\r\n\r\n        return `${authorizationUrl}?${params}`;\r\n    }\r\n\r\n    private createEndSessionUrl(end_session_endpoint: string, id_token_hint: string) {\r\n        const urlParts = end_session_endpoint.split('?');\r\n\r\n        const authorizationEndsessionUrl = urlParts[0];\r\n\r\n        let params = new HttpParams({\r\n            fromString: urlParts[1],\r\n            encoder: new UriEncoder(),\r\n        });\r\n        params = params.set('id_token_hint', id_token_hint);\r\n        params = params.append('post_logout_redirect_uri', this.configurationProvider.openIDConfiguration.post_logout_redirect_uri);\r\n\r\n        return `${authorizationEndsessionUrl}?${params}`;\r\n    }\r\n\r\n    private getSigningKeys(): Observable<JwtKeys> {\r\n        if (this.configurationProvider.wellKnownEndpoints) {\r\n            this.loggerService.logDebug('jwks_uri: ' + this.configurationProvider.wellKnownEndpoints.jwks_uri);\r\n\r\n            return this.oidcDataService\r\n                .get<JwtKeys>(this.configurationProvider.wellKnownEndpoints.jwks_uri || '')\r\n                .pipe(catchError(this.handleErrorGetSigningKeys));\r\n        } else {\r\n            this.loggerService.logWarning('getSigningKeys: authWellKnownEndpoints is undefined');\r\n        }\r\n\r\n        return this.oidcDataService.get<JwtKeys>('undefined').pipe(catchError(this.handleErrorGetSigningKeys));\r\n    }\r\n\r\n    private handleErrorGetSigningKeys(error: Response | any) {\r\n        let errMsg: string;\r\n        if (error instanceof Response) {\r\n            const body = error.json() || {};\r\n            const err = JSON.stringify(body);\r\n            errMsg = `${error.status} - ${error.statusText || ''} ${err}`;\r\n        } else {\r\n            errMsg = error.message ? error.message : error.toString();\r\n        }\r\n        this.loggerService.logError(errMsg);\r\n        return throwError(errMsg);\r\n    }\r\n\r\n    private runTokenValidation() {\r\n        if (this.runTokenValidationRunning || !this.configurationProvider.openIDConfiguration.silent_renew) {\r\n            return;\r\n        }\r\n        this.runTokenValidationRunning = true;\r\n        this.loggerService.logDebug('runTokenValidation silent-renew running');\r\n\r\n        /**\r\n         *   First time: delay 10 seconds to call silentRenewHeartBeatCheck\r\n         *   Afterwards: Run this check in a 5 second interval only AFTER the previous operation ends.\r\n         */\r\n        const silentRenewHeartBeatCheck = () => {\r\n            this.loggerService.logDebug(\r\n                'silentRenewHeartBeatCheck\\r\\n' +\r\n                    `\\tsilentRenewRunning: ${this.oidcSecurityCommon.silentRenewRunning === 'running'}\\r\\n` +\r\n                    `\\tidToken: ${!!this.getIdToken()}\\r\\n` +\r\n                    `\\t_userData.value: ${!!this._userData.value}`\r\n            );\r\n            if (this._userData.value && this.oidcSecurityCommon.silentRenewRunning !== 'running' && this.getIdToken()) {\r\n                if (\r\n                    this.oidcSecurityValidation.isTokenExpired(\r\n                        this.oidcSecurityCommon.idToken,\r\n                        this.configurationProvider.openIDConfiguration.silent_renew_offset_in_seconds\r\n                    )\r\n                ) {\r\n                    this.loggerService.logDebug('IsAuthorized: id_token isTokenExpired, start silent renew if active');\r\n\r\n                    if (this.configurationProvider.openIDConfiguration.silent_renew) {\r\n                        this.refreshSession().subscribe(\r\n                            () => {\r\n                                this._scheduledHeartBeat = setTimeout(silentRenewHeartBeatCheck, 3000);\r\n                            },\r\n                            (err: any) => {\r\n                                this.loggerService.logError('Error: ' + err);\r\n                                this._scheduledHeartBeat = setTimeout(silentRenewHeartBeatCheck, 3000);\r\n                            }\r\n                        );\r\n                        /* In this situation, we schedule a heartbeat check only when silentRenew is finished.\r\n                        We don't want to schedule another check so we have to return here */\r\n                        return;\r\n                    } else {\r\n                        this.resetAuthorizationData(false);\r\n                    }\r\n                }\r\n            }\r\n\r\n            /* Delay 3 seconds and do the next check */\r\n            this._scheduledHeartBeat = setTimeout(silentRenewHeartBeatCheck, 3000);\r\n        };\r\n\r\n        this.zone.runOutsideAngular(() => {\r\n            /* Initial heartbeat check */\r\n            this._scheduledHeartBeat = setTimeout(silentRenewHeartBeatCheck, 10000);\r\n        });\r\n    }\r\n\r\n    private silentRenewEventHandler(e: CustomEvent) {\r\n        this.loggerService.logDebug('silentRenewEventHandler');\r\n\r\n        if (this.configurationProvider.openIDConfiguration.response_type === 'code') {\r\n            const urlParts = e.detail.toString().split('?');\r\n            const params = new HttpParams({\r\n                fromString: urlParts[1],\r\n            });\r\n            const code = params.get('code');\r\n            const state = params.get('state');\r\n            const session_state = params.get('session_state');\r\n            const error = params.get('error');\r\n            if (code && state) {\r\n                this.requestTokensWithCodeProcedure(code, state, session_state);\r\n            }\r\n            if (error) {\r\n                this._onAuthorizationResult.next(new AuthorizationResult(AuthorizationState.unauthorized, ValidationResult.LoginRequired, true));\r\n                this.resetAuthorizationData(false);\r\n                this.oidcSecurityCommon.authNonce = '';\r\n                this.loggerService.logDebug(e.detail.toString());\r\n            }\r\n        } else {\r\n            // ImplicitFlow\r\n            this.authorizedImplicitFlowCallback(e.detail);\r\n        }\r\n    }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { OidcDataService } from '../data-services/oidc-data.service';\r\nimport { IFrameService } from '../services/existing-iframe.service';\r\nimport { EqualityHelperService } from '../services/oidc-equality-helper.service';\r\nimport { StateValidationService } from '../services/oidc-security-state-validation.service';\r\nimport { TokenHelperService } from '../services/oidc-token-helper.service';\r\nimport { LoggerService } from '../services/oidc.logger.service';\r\nimport { OidcSecurityCheckSession } from '../services/oidc.security.check-session';\r\nimport { OidcSecurityCommon } from '../services/oidc.security.common';\r\nimport { OidcConfigService } from '../services/oidc.security.config.service';\r\nimport { OidcSecurityService } from '../services/oidc.security.service';\r\nimport { OidcSecuritySilentRenew } from '../services/oidc.security.silent-renew';\r\nimport { BrowserStorage, OidcSecurityStorage } from '../services/oidc.security.storage';\r\nimport { OidcSecurityUserService } from '../services/oidc.security.user-service';\r\nimport { OidcSecurityValidation } from '../services/oidc.security.validation';\r\n\r\n@NgModule()\r\nexport class AuthModule {\r\n    static forRoot(token: Token = {}): ModuleWithProviders {\r\n        return {\r\n            ngModule: AuthModule,\r\n            providers: [\r\n                OidcConfigService,\r\n                OidcSecurityService,\r\n                OidcSecurityValidation,\r\n                OidcSecurityCheckSession,\r\n                OidcSecuritySilentRenew,\r\n                OidcSecurityUserService,\r\n                OidcSecurityCommon,\r\n                TokenHelperService,\r\n                LoggerService,\r\n                IFrameService,\r\n                EqualityHelperService,\r\n                OidcDataService,\r\n                StateValidationService,\r\n                {\r\n                    provide: OidcSecurityStorage,\r\n                    useClass: token.storage || BrowserStorage,\r\n                },\r\n            ],\r\n        };\r\n    }\r\n}\r\n\r\nexport interface Type<T> extends Function {\r\n    new (...args: any[]): T;\r\n}\r\n\r\nexport interface Token {\r\n    storage?: Type<any>;\r\n}\r\n"],"names":["HttpHeaders","Injectable","HttpClient","isPlatformBrowser","Inject","PLATFORM_ID","Subject","tslib_1.__values","KEYUTIL","KJUR","hextob64u","from","Observable","take","NgZone","ReplaySubject","switchMap","catchError","of","map","router","BehaviorSubject","filter","tap","race","timer","switchMapTo","shareReplay","throwError","oneLine","HttpParams","Router","NgModule"],"mappings":"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"}
